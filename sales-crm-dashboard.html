<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì˜ì—… ëŒ€ì‹œë³´ë“œ | UBì¼€ì–´</title>
<link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0a0e1a;--surface:#111827;--surface2:#1a2235;--border:#1f2d45;
  --accent:#3b82f6;--accent2:#06b6d4;--success:#10b981;
  --warning:#f59e0b;--danger:#ef4444;--text:#f1f5f9;
  --text2:#94a3b8;--text3:#64748b;--gold:#f59e0b;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Pretendard',-apple-system,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;}

/* â”€â”€ ë¡œê·¸ì¸ â”€â”€ */
#loginScreen{min-height:100vh;display:flex;align-items:center;justify-content:center;background:radial-gradient(ellipse at 60% 40%,#0d1f40 0%,#0a0e1a 70%);}
.login-box{background:var(--surface);border:1px solid var(--border);border-radius:20px;padding:48px 40px;width:420px;max-width:90vw;box-shadow:0 32px 80px rgba(0,0,0,.5);}
.login-logo{font-size:22px;font-weight:900;letter-spacing:-.5px;margin-bottom:8px;}
.login-logo span{color:var(--accent);}
.login-subtitle{font-size:13px;color:var(--text3);margin-bottom:36px;}
.login-role-tabs{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:28px;}
.role-tab{padding:12px;border-radius:10px;border:2px solid var(--border);background:var(--surface2);color:var(--text2);font-size:13px;font-weight:700;cursor:pointer;text-align:center;transition:all .2s;font-family:'Pretendard',sans-serif;}
.role-tab:hover{border-color:var(--accent);color:var(--accent);}
.role-tab.active{border-color:var(--accent);background:rgba(59,130,246,.15);color:var(--accent);}
.login-field{margin-bottom:16px;}
.login-field label{font-size:12px;font-weight:700;color:var(--text3);display:block;margin-bottom:6px;letter-spacing:.5px;}
.login-input{width:100%;padding:12px 14px;border-radius:10px;border:1px solid var(--border);background:var(--surface2);color:var(--text);font-size:14px;font-family:'Pretendard',sans-serif;outline:none;transition:border-color .2s;}
.login-input:focus{border-color:var(--accent);}
.login-select{width:100%;padding:12px 14px;border-radius:10px;border:1px solid var(--border);background:var(--surface2);color:var(--text);font-size:14px;font-family:'Pretendard',sans-serif;outline:none;cursor:pointer;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%2364748b' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14L2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 14px center;}
.login-btn{width:100%;padding:14px;border-radius:10px;border:none;background:var(--accent);color:#fff;font-size:15px;font-weight:800;cursor:pointer;margin-top:8px;transition:background .2s;font-family:'Pretendard',sans-serif;}
.login-btn:hover{background:#2563eb;}
.login-hint{font-size:11px;color:var(--text3);text-align:center;margin-top:16px;}

/* â”€â”€ ì•± â”€â”€ */
#app{display:none;}
.screen{display:none;animation:fadeIn .35s ease;}
.screen.active{display:block;}
@keyframes fadeIn{from{opacity:0;transform:translateY(12px);}to{opacity:1;transform:translateY(0);}}

/* â”€â”€ í—¤ë” â”€â”€ */
header{position:sticky;top:0;z-index:100;background:rgba(10,14,26,.95);backdrop-filter:blur(16px);border-bottom:1px solid var(--border);padding:0 32px;height:60px;display:flex;align-items:center;justify-content:space-between;}
.logo{font-size:17px;font-weight:800;letter-spacing:-.5px;}
.logo span{color:var(--accent);}
.breadcrumb{display:flex;align-items:center;gap:8px;font-size:13px;color:var(--text3);}
.breadcrumb .crumb{cursor:pointer;transition:color .2s;}
.breadcrumb .crumb:hover{color:var(--text);}
.breadcrumb .crumb.active{color:var(--text);font-weight:600;}
.breadcrumb .sep{color:var(--border);}
.header-right{display:flex;align-items:center;gap:12px;}
.role-badge{font-size:11px;font-weight:700;padding:4px 10px;border-radius:20px;letter-spacing:.5px;background:rgba(59,130,246,.15);color:var(--accent);border:1px solid rgba(59,130,246,.3);}
.hq-badge{background:rgba(245,158,11,.15)!important;color:var(--gold)!important;border-color:rgba(245,158,11,.3)!important;}
.date-badge{font-size:12px;color:var(--text3);}
.logout-btn{font-size:11px;font-weight:700;padding:4px 10px;border-radius:8px;border:1px solid var(--border);background:transparent;color:var(--text3);cursor:pointer;transition:all .2s;font-family:'Pretendard',sans-serif;}
.logout-btn:hover{border-color:var(--danger);color:var(--danger);}

/* â”€â”€ ê³µí†µ ë ˆì´ì•„ì›ƒ â”€â”€ */
.main{max-width:1400px;margin:0 auto;padding:32px;}
.page-title{font-size:24px;font-weight:800;letter-spacing:-.5px;margin-bottom:4px;}
.page-sub{font-size:13px;color:var(--text3);}
.section-header{display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap;gap:12px;}
.section-title{font-size:16px;font-weight:800;margin-bottom:4px;}
.section-sub{font-size:12px;color:var(--text3);}
.back-btn{display:inline-flex;align-items:center;gap:8px;font-size:13px;font-weight:600;color:var(--text3);cursor:pointer;margin-bottom:24px;transition:color .2s;background:none;border:none;}
.back-btn:hover{color:var(--text);}

/* â”€â”€ ê¸°ê°„ í•„í„° â”€â”€ */
.period-filter-bar{display:flex;align-items:center;gap:8px;flex-wrap:wrap;}
.period-btn{padding:7px 14px;border-radius:8px;font-size:12px;font-weight:700;border:1px solid var(--border);background:var(--surface);color:var(--text2);cursor:pointer;transition:all .2s;white-space:nowrap;font-family:'Pretendard',sans-serif;}
.period-btn:hover{border-color:var(--accent);color:var(--accent);}
.period-btn.active{background:var(--accent);color:#fff;border-color:var(--accent);}
.period-custom-wrap{display:flex;align-items:center;gap:6px;background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:4px 10px;}
.date-input{background:transparent;border:none;outline:none;color:var(--text);font-size:12px;font-family:'Pretendard',sans-serif;cursor:pointer;width:110px;}
.date-input::-webkit-calendar-picker-indicator{filter:invert(.6);cursor:pointer;}

/* â”€â”€ ë¹„êµ ì„¹ì…˜ â”€â”€ */
.compare-section{background:linear-gradient(135deg,#0f1c3a 0%,#0a1628 100%);border:1px solid rgba(59,130,246,.25);border-radius:16px;padding:28px;margin-bottom:28px;position:relative;overflow:hidden;}
.compare-section::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,var(--accent),var(--accent2));}
.compare-title{font-size:13px;font-weight:700;color:var(--accent2);letter-spacing:1px;text-transform:uppercase;margin-bottom:20px;}
.compare-grid{display:grid;grid-template-columns:1fr 40px 1fr;gap:0;align-items:start;}
.compare-label{font-size:11px;font-weight:700;letter-spacing:1px;text-transform:uppercase;margin-bottom:16px;}
.compare-label.mine{color:var(--accent);}
.compare-label.best{color:var(--gold);}
.compare-divider{display:flex;align-items:center;justify-content:center;padding-top:30px;color:var(--text3);font-size:11px;font-weight:700;}
.kpi-compare-list{display:flex;flex-direction:column;gap:10px;}
.kpi-compare-item{display:flex;align-items:center;justify-content:space-between;background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:12px 16px;}
.kpi-compare-item.highlight-mine{border-color:rgba(59,130,246,.4);}
.kpi-compare-item.highlight-best{border-color:rgba(245,158,11,.4);}
.kci-name{font-size:12px;color:var(--text2);}
.kci-value{font-size:20px;font-weight:800;letter-spacing:-.5px;}
.kci-value.good{color:var(--success);}
.kci-value.warn{color:var(--warning);}
.kci-value.bad{color:var(--danger);}
.kci-sub{font-size:11px;color:var(--text3);margin-top:2px;}
.action-guide{margin-top:20px;background:rgba(239,68,68,.08);border:1px solid rgba(239,68,68,.25);border-radius:10px;padding:16px 20px;}
.action-guide-title{font-size:11px;font-weight:700;letter-spacing:1px;color:var(--danger);margin-bottom:8px;}
.action-items{display:flex;flex-direction:column;gap:6px;}
.action-item{font-size:13px;color:var(--text);display:flex;align-items:flex-start;gap:8px;}
.action-item::before{content:'â†’';color:var(--danger);flex-shrink:0;}

/* â”€â”€ KPI ì¹´ë“œ â”€â”€ */
.kpi-row{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:28px;}
.kpi-card{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:20px 22px;transition:transform .2s,border-color .2s;}
.kpi-card:hover{transform:translateY(-2px);border-color:rgba(59,130,246,.4);}
.kpi-card-icon{font-size:22px;margin-bottom:12px;}
.kpi-card-label{font-size:11px;font-weight:700;letter-spacing:1px;color:var(--text3);text-transform:uppercase;margin-bottom:8px;}
.kpi-card-value{font-size:34px;font-weight:900;letter-spacing:-1px;line-height:1;}
.kpi-card-value.cyan{color:var(--accent2);}
.kpi-card-value.gold{color:var(--gold);}
.kpi-card-value.blue{color:var(--accent);}
.kpi-card-value.green{color:var(--success);}
.kpi-card-sub{font-size:12px;color:var(--text3);margin-top:8px;}
.kpi-card-bar{height:3px;background:var(--border);border-radius:2px;margin-top:14px;overflow:hidden;}
.kpi-card-bar-fill{height:100%;border-radius:2px;transition:width 1s ease;}

/* â”€â”€ ìƒíƒœ ë²”ë¡€ â”€â”€ */
.status-legend-wrap{position:relative;}
.status-legend-btn{font-size:11px;font-weight:700;padding:6px 14px;border-radius:8px;border:1px solid var(--border);background:var(--surface2);color:var(--text3);cursor:pointer;transition:all .2s;font-family:'Pretendard',sans-serif;white-space:nowrap;}
.status-legend-btn:hover{border-color:var(--accent);color:var(--text);}
.status-legend-popup{display:none;position:absolute;right:0;top:calc(100% + 8px);z-index:300;background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:20px;width:330px;box-shadow:0 20px 60px rgba(0,0,0,.6);}
.status-legend-popup.show{display:block;}
.legend-title{font-size:12px;font-weight:800;color:var(--text2);margin-bottom:14px;letter-spacing:.5px;}
.legend-row{display:flex;align-items:flex-start;gap:10px;margin-bottom:12px;}
.legend-row:last-child{margin-bottom:0;}
.legend-pill{flex-shrink:0;padding:3px 10px;border-radius:20px;font-size:11px;font-weight:700;margin-top:2px;}
.legend-desc{font-size:12px;color:var(--text2);line-height:1.5;}
.legend-desc strong{color:var(--text);}
.legend-divider{height:1px;background:var(--border);margin:12px 0;}

/* â”€â”€ ëŒ€ë¦¬ì  í…Œì´ë¸” â”€â”€ */
.dealer-table-wrap{background:var(--surface);border:1px solid var(--border);border-radius:14px;overflow:hidden;margin-bottom:28px;}
.dealer-table{width:100%;border-collapse:collapse;}
.dealer-table thead tr{background:var(--surface2);border-bottom:1px solid var(--border);}
.dealer-table th{padding:12px 16px;text-align:left;font-size:11px;font-weight:700;letter-spacing:.5px;color:var(--text3);white-space:nowrap;}
.dealer-table tbody tr{border-bottom:1px solid rgba(31,45,69,.5);transition:background .15s;cursor:pointer;}
.dealer-table tbody tr:last-child{border-bottom:none;}
.dealer-table tbody tr:hover{background:var(--surface2);}
.dealer-table td{padding:14px 16px;font-size:13px;vertical-align:middle;}
.rank-badge{display:inline-flex;align-items:center;justify-content:center;width:24px;height:24px;border-radius:6px;font-size:12px;font-weight:800;}
.rank-1{background:rgba(245,158,11,.2);color:var(--gold);}
.rank-2{background:rgba(148,163,184,.15);color:#94a3b8;}
.rank-3{background:rgba(180,120,60,.15);color:#cd7f32;}
.rank-n{background:rgba(31,45,69,.8);color:var(--text3);}
.my-row{background:rgba(59,130,246,.05)!important;}
.my-tag{display:inline-block;font-size:10px;font-weight:700;padding:2px 6px;border-radius:4px;background:rgba(59,130,246,.2);color:var(--accent);margin-left:6px;}
.pill{display:inline-block;padding:3px 10px;border-radius:20px;font-size:11px;font-weight:700;}
.pill-excellent{background:rgba(16,185,129,.2);color:#6ee7b7;border:1px solid rgba(16,185,129,.4);}
.pill-good{background:rgba(16,185,129,.1);color:var(--success);}
.pill-normal{background:rgba(245,158,11,.1);color:var(--warning);}
.pill-warning{background:rgba(245,158,11,.15);color:var(--warning);}
.pill-danger{background:rgba(239,68,68,.15);color:var(--danger);}
.clickable-num{font-weight:700;color:var(--accent);cursor:pointer;text-decoration:underline;text-decoration-color:rgba(59,130,246,.3);text-underline-offset:3px;transition:color .2s;}
.clickable-num:hover{color:var(--accent2);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SCREEN 2 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
/* ëŒ€ë¦¬ì  ìƒë‹¨ ì§€í‘œë°” */
.dealer-info-bar{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:20px 28px;margin-bottom:24px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:16px;}
.dib-left{flex:1;min-width:200px;}
.dib-name{font-size:22px;font-weight:800;margin-bottom:4px;}
.dib-region{font-size:12px;color:var(--text3);}
.dib-kpis{display:flex;gap:0;border-left:1px solid var(--border);}
.dib-kpi{text-align:center;padding:0 24px;border-right:1px solid var(--border);}
.dib-kpi:last-child{border-right:none;}
.dib-kpi-v{font-size:24px;font-weight:900;margin-bottom:2px;}
.dib-kpi-l{font-size:11px;color:var(--text3);}
.dib-kpi-goal{font-size:10px;margin-top:2px;}

/* í•„í„°ë°” */
.filter-bar{display:flex;align-items:center;gap:10px;margin-bottom:20px;flex-wrap:wrap;}
.filter-btn{padding:6px 14px;border-radius:20px;font-size:12px;font-weight:600;border:1px solid var(--border);background:var(--surface);color:var(--text2);cursor:pointer;transition:all .2s;font-family:'Pretendard',sans-serif;}
.filter-btn:hover,.filter-btn.active{background:var(--accent);color:#fff;border-color:var(--accent);}

/* ê³ ê° í…Œì´ë¸” */
.customer-table-wrap{background:var(--surface);border:1px solid var(--border);border-radius:14px;overflow:hidden;}
.customer-table{width:100%;border-collapse:collapse;}
.customer-table thead tr{background:var(--surface2);border-bottom:1px solid var(--border);}
.customer-table th{padding:12px 14px;text-align:left;font-size:11px;font-weight:700;letter-spacing:.5px;color:var(--text3);white-space:nowrap;}
.customer-table tbody tr{border-bottom:1px solid rgba(31,45,69,.5);cursor:pointer;transition:background .15s;}
.customer-table tbody tr:last-child{border-bottom:none;}
.customer-table tbody tr:hover{background:var(--surface2);}
.customer-table td{padding:12px 14px;font-size:13px;vertical-align:middle;}
/* ì˜ì—…ë‹¨ê³„ badge */
.contact-badge{display:inline-flex;align-items:center;gap:4px;padding:3px 10px;border-radius:20px;font-size:11px;font-weight:700;}
.contact-0{background:rgba(100,116,139,.15);color:var(--text3);}
.contact-1{background:rgba(59,130,246,.15);color:var(--accent);}
.contact-2{background:rgba(6,182,212,.15);color:var(--accent2);}
.contact-3{background:rgba(245,158,11,.15);color:var(--warning);}
.contact-4{background:rgba(249,115,22,.15);color:#fb923c;}
.contact-5{background:rgba(16,185,129,.15);color:var(--success);}
/* ë°©ë¬¸ badge */
.visited-yes{display:inline-block;padding:3px 10px;border-radius:20px;font-size:11px;font-weight:700;background:rgba(16,185,129,.15);color:var(--success);}
.visited-no{display:inline-block;padding:3px 10px;border-radius:20px;font-size:11px;font-weight:700;background:rgba(239,68,68,.12);color:var(--danger);}
/* ì˜ì—…ìƒíƒœ badge */
.sales-status{display:inline-block;padding:3px 10px;border-radius:20px;font-size:11px;font-weight:700;cursor:pointer;transition:opacity .2s;}
.sales-status:hover{opacity:.8;}
.ss-idle{background:rgba(100,116,139,.15);color:var(--text3);}
.ss-active{background:rgba(59,130,246,.15);color:var(--accent);}
.ss-success{background:rgba(16,185,129,.2);color:var(--success);}
.ss-fail{background:rgba(239,68,68,.15);color:var(--danger);}
.ss-hold{background:rgba(245,158,11,.15);color:var(--warning);}
/* ìƒíƒœ ë“œë¡­ë‹¤ìš´ */
.status-dropdown-wrap{position:relative;display:inline-block;}
.status-dropdown{display:none;position:absolute;left:0;top:calc(100% + 4px);z-index:200;background:var(--surface);border:1px solid var(--border);border-radius:10px;overflow:hidden;min-width:110px;box-shadow:0 10px 30px rgba(0,0,0,.4);}
.status-dropdown.open{display:block;}
.status-dropdown-item{padding:9px 14px;font-size:12px;font-weight:600;cursor:pointer;transition:background .15s;white-space:nowrap;}
.status-dropdown-item:hover{background:var(--surface2);}

/* ì•„ì´í…œ íƒœê·¸ */
.item-micro{font-size:10px;padding:2px 6px;border-radius:4px;font-weight:700;margin-right:2px;}
.item-micro.yuparm{background:rgba(59,130,246,.2);color:var(--accent);}
.item-micro.addon{background:rgba(100,116,139,.12);color:var(--text3);}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SCREEN 3 â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.customer-detail-grid{display:grid;grid-template-columns:320px 1fr;gap:24px;}

/* ê³ ê° ì •ë³´ ì¹´ë“œ */
.customer-info-card{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:24px;height:fit-content;position:sticky;top:80px;}
.cust-avatar{width:52px;height:52px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-size:20px;font-weight:800;margin-bottom:14px;}
.cust-name{font-size:18px;font-weight:800;margin-bottom:3px;}
.cust-pharmacy{font-size:13px;color:var(--text2);margin-bottom:14px;}
.info-divider{height:1px;background:var(--border);margin:14px 0;}
.info-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;font-size:13px;}
.info-label{color:var(--text3);}
.info-value{font-weight:600;}
.item-tags{display:flex;flex-wrap:wrap;gap:5px;margin-top:4px;}
.item-tag{padding:3px 9px;border-radius:6px;font-size:11px;font-weight:700;}
.item-tag.yuparm{background:rgba(59,130,246,.2);border:1px solid rgba(59,130,246,.4);color:var(--accent);}
.item-tag.addon{background:rgba(100,116,139,.1);border:1px solid var(--border);color:var(--text3);}
/* ìš”ì•½ ì§€í‘œ ê·¸ë¦¬ë“œ */
.kpi-mini-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:14px;}
.kpi-mini{background:var(--surface2);border-radius:10px;padding:11px;text-align:center;}
.kpi-mini-v{font-size:16px;font-weight:800;}
.kpi-mini-l{font-size:10px;color:var(--text3);margin-top:3px;}

/* ì˜ì—…ì´ë ¥ ì¹´ë“œ */
.history-card{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:24px;}
.history-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;}
.history-title{font-size:16px;font-weight:800;}

/* ì´ë ¥ ìŠ¤ë ˆë“œ */
.thread-wrap{display:flex;flex-direction:column;gap:0;}
.thread-item{display:flex;gap:14px;position:relative;}
.thread-item:not(:last-child) .thread-line{position:absolute;left:19px;top:40px;bottom:0;width:2px;background:var(--border);}
.thread-dot-wrap{flex-shrink:0;width:38px;height:38px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:800;z-index:1;}
.thread-dot-0{background:rgba(100,116,139,.2);color:var(--text3);}  /* ë¬¸ì˜ì ‘ìˆ˜ */
.thread-dot-1{background:rgba(59,130,246,.2);color:var(--accent);}
.thread-dot-2{background:rgba(6,182,212,.2);color:var(--accent2);}
.thread-dot-3{background:rgba(245,158,11,.2);color:var(--warning);}
.thread-dot-4{background:rgba(249,115,22,.2);color:#fb923c;}
.thread-dot-5{background:rgba(16,185,129,.2);color:var(--success);}
.thread-content{flex:1;padding-bottom:24px;}
.thread-meta{display:flex;align-items:center;gap:10px;margin-bottom:6px;flex-wrap:wrap;}
.thread-contact-label{font-size:12px;font-weight:800;color:var(--text);}
.thread-who{font-size:11px;color:var(--text3);}
.thread-when{font-size:11px;color:var(--text3);}
.thread-elapsed{font-size:11px;font-weight:700;padding:2px 8px;border-radius:10px;background:rgba(59,130,246,.1);color:var(--accent);}
.thread-body{background:var(--surface2);border-radius:10px;padding:14px;font-size:13px;color:var(--text2);line-height:1.65;border-left:3px solid var(--border);}
.thread-body.good{border-left-color:var(--success);}
.thread-body.warn{border-left-color:var(--warning);}
.thread-tags{display:flex;gap:6px;margin-top:8px;flex-wrap:wrap;}
.thread-tag{font-size:11px;padding:2px 8px;border-radius:4px;background:var(--border);color:var(--text3);font-weight:600;}

/* ì´ë ¥ ì…ë ¥ í¼ */
.history-input-area{margin-top:20px;background:var(--surface2);border:1px solid var(--border);border-radius:12px;padding:16px;}
.history-input-label{font-size:12px;font-weight:700;color:var(--accent2);letter-spacing:.5px;margin-bottom:10px;}
.history-textarea{width:100%;background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:12px 14px;color:var(--text);font-size:13px;font-family:'Pretendard',sans-serif;outline:none;resize:none;line-height:1.6;transition:border-color .2s;}
.history-textarea:focus{border-color:var(--accent);}
.history-input-footer{display:flex;align-items:center;justify-content:space-between;margin-top:10px;flex-wrap:wrap;gap:8px;}
.history-meta-inputs{display:flex;align-items:center;gap:8px;flex-wrap:wrap;}
.meta-select{padding:6px 10px;border-radius:8px;border:1px solid var(--border);background:var(--surface);color:var(--text2);font-size:12px;font-family:'Pretendard',sans-serif;outline:none;cursor:pointer;}
.history-submit-btn{padding:8px 20px;border-radius:8px;border:none;background:var(--accent);color:#fff;font-size:13px;font-weight:700;cursor:pointer;font-family:'Pretendard',sans-serif;transition:background .2s;}
.history-submit-btn:hover{background:#2563eb;}

/* ë‹¤ìŒ ì•¡ì…˜ ë°•ìŠ¤ */
.next-action-box{background:rgba(59,130,246,.08);border:1px solid rgba(59,130,246,.3);border-radius:10px;padding:16px 20px;margin-top:20px;}
.nab-title{font-size:11px;font-weight:700;letter-spacing:1px;color:var(--accent);margin-bottom:8px;text-transform:uppercase;}
.nab-content{font-size:13px;color:var(--text);line-height:1.5;}

@media(max-width:900px){
  .main{padding:16px;}
  .kpi-row{grid-template-columns:repeat(2,1fr);}
  .compare-grid{grid-template-columns:1fr;}
  .compare-divider{display:none;}
  .customer-detail-grid{grid-template-columns:1fr;}
  .dib-kpis{gap:0;border-left:none;flex-wrap:wrap;}
  .dib-kpi{padding:8px 12px;border-right:none;border-bottom:1px solid var(--border);}
  .status-legend-popup{right:auto;left:0;width:280px;}
}
</style>
</head>
<body>

<!-- â•â•â•â•â•â• ë¡œê·¸ì¸ â•â•â•â•â•â• -->
<div id="loginScreen">
  <div class="login-box">
    <div class="login-logo">UB<span>CARE</span> ì˜ì—…CRM</div>
    <div class="login-subtitle">ì˜ì—… ëŒ€ì‹œë³´ë“œì— ë¡œê·¸ì¸í•˜ì„¸ìš”</div>
    <div class="login-role-tabs">
      <button class="role-tab active" onclick="selectRole('dealer',this)">ğŸ¢ ëŒ€ë¦¬ì </button>
      <button class="role-tab" onclick="selectRole('hq',this)">ğŸ›ï¸ ë³¸ì‚¬</button>
    </div>
    <div class="login-field" id="dealerSelectWrap">
      <label>ëŒ€ë¦¬ì  ì„ íƒ</label>
      <select class="login-select" id="dealerSelect">
        <option value="">-- ëŒ€ë¦¬ì ì„ ì„ íƒí•˜ì„¸ìš” --</option>
        <option>ìœ ë¹„ê°•ë‚¨</option><option>ì—ë²„ë„·</option><option>ì´ì•ˆë©”ë“œ</option>
        <option>ì„¸ì¼ë©”ë””íŒœ</option><option>ë¹„ì¦ˆí˜„ë©”ë””ì¹¼</option><option>ë””ì¼€ì´íŒœì¼€ì–´</option>
        <option>ë””ì›ì¼€ì–´</option><option>ìœ ë¹„ê²½ì¸</option><option>ë””ë¼ì¸</option>
        <option>ë‘ë¦¬ì•¤íŒœ</option><option>ë©”ë””ì¼€ì–´</option><option>ì˜¬ë°ì´íŒœ</option>
        <option>ì´ì˜¤ì•¤íŒœ</option><option>ì•„ì´í¬ì»¤ìŠ¤</option><option>ë™ì›ë©”ë””í…</option>
      </select>
    </div>
    <div class="login-field">
      <label>ì•„ì´ë””</label>
      <input type="text" class="login-input" id="loginId" placeholder="ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
    </div>
    <div class="login-field">
      <label>ë¹„ë°€ë²ˆí˜¸</label>
      <input type="password" class="login-input" id="loginPw" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
    </div>
    <button class="login-btn" onclick="doLogin()">ë¡œê·¸ì¸</button>
    <div class="login-hint">â€» ë°ëª¨ ë²„ì „: ì•„ë¬´ ê°’ì´ë‚˜ ì…ë ¥ í›„ ë¡œê·¸ì¸</div>
  </div>
</div>

<!-- â•â•â•â•â•â• ì•± â•â•â•â•â•â• -->
<div id="app">
<header>
  <div class="logo">UB<span>CARE</span> ì˜ì—…CRM</div>
  <div class="breadcrumb" id="breadcrumb"><span class="crumb active" onclick="goScreen(1)">ì˜ì—… ëŒ€ì‹œë³´ë“œ</span></div>
  <div class="header-right">
    <span class="role-badge" id="roleBadge"></span>
    <span class="date-badge" id="dateBadge"></span>
    <button class="logout-btn" onclick="doLogout()">ë¡œê·¸ì•„ì›ƒ</button>
  </div>
</header>

<!-- â•â•â•â•â•â• SCREEN 1 â•â•â•â•â•â• -->
<div class="screen active" id="screen1">
<div class="main">
  <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px;margin-bottom:24px;">
    <div>
      <div class="page-title">ì˜ì—… ëŒ€ì‹œë³´ë“œ</div>
      <div class="page-sub" id="periodLabel"></div>
    </div>
    <div class="period-filter-bar">
      <button class="period-btn" data-period="7">ìµœê·¼ 7ì¼</button>
      <button class="period-btn" data-period="30">ìµœê·¼ 30ì¼</button>
      <button class="period-btn active" data-period="90">ìµœê·¼ 3ê°œì›”</button>
      <button class="period-btn" data-period="180">ìµœê·¼ 6ê°œì›”</button>
      <button class="period-btn" data-period="365">ìµœê·¼ 1ë…„</button>
      <div class="period-custom-wrap">
        <input type="date" id="dateFrom" class="date-input">
        <span style="color:var(--text3);font-size:12px">~</span>
        <input type="date" id="dateTo" class="date-input">
        <button class="period-btn" id="customApplyBtn">ì ìš©</button>
      </div>
    </div>
  </div>

  <!-- ë¹„êµ ì„¹ì…˜ -->
  <div class="compare-section" id="compareSection">
    <div class="compare-title">âš¡ ë‚´ ëŒ€ë¦¬ì  vs Best ëŒ€ë¦¬ì  í•µì‹¬ ì§€í‘œ ë¹„êµ</div>
    <div class="compare-grid">
      <div class="compare-side">
        <div class="compare-label mine" id="mineSideLabel"></div>
        <div class="kpi-compare-list" id="mineKpiList"></div>
      </div>
      <div class="compare-divider">VS</div>
      <div class="compare-side">
        <div class="compare-label best" id="bestSideLabel"></div>
        <div class="kpi-compare-list" id="bestKpiList"></div>
      </div>
    </div>
    <div class="action-guide">
      <div class="action-guide-title">ğŸš¨ ì§€ê¸ˆ ë°”ë¡œ í•´ì•¼ í•  ì¼</div>
      <div class="action-items" id="actionItems"></div>
    </div>
  </div>

  <!-- KPI ì¹´ë“œ -->
  <div class="kpi-row">
    <div class="kpi-card"><div class="kpi-card-icon">âš¡</div><div class="kpi-card-label">1ì°¨ ì ‘ì´‰ í‰ê· </div><div class="kpi-card-value cyan" id="kv-c1">-<span style="font-size:20px">ì¼</span></div><div class="kpi-card-sub">ë¬¸ì˜â†’1ì°¨ ì´ë ¥ ê¸°ì¤€ Â· ëª©í‘œ 1ì¼</div><div class="kpi-card-bar"><div class="kpi-card-bar-fill" id="kb-c1" style="background:var(--accent2)"></div></div></div>
    <div class="kpi-card"><div class="kpi-card-icon">ğŸ“…</div><div class="kpi-card-label">2ì°¨ ì ‘ì´‰ í‰ê· </div><div class="kpi-card-value gold" id="kv-c2">-<span style="font-size:20px">ì¼</span></div><div class="kpi-card-sub">1ì°¨â†’2ì°¨ ì´ë ¥ ê¸°ì¤€ Â· ëª©í‘œ 3ì¼</div><div class="kpi-card-bar"><div class="kpi-card-bar-fill" id="kb-c2" style="background:var(--gold)"></div></div></div>
    <div class="kpi-card"><div class="kpi-card-icon">ğŸƒ</div><div class="kpi-card-label">ì „ì²´ ë°©ë¬¸ìœ¨</div><div class="kpi-card-value blue" id="kv-visit">-<span style="font-size:20px">%</span></div><div class="kpi-card-sub">ë°©ë¬¸ì™„ë£Œ ê³ ê° ë¹„ìœ¨ Â· ëª©í‘œ 80%</div><div class="kpi-card-bar"><div class="kpi-card-bar-fill" id="kb-visit" style="background:var(--accent)"></div></div></div>
    <div class="kpi-card"><div class="kpi-card-icon">âœ…</div><div class="kpi-card-label">ì „ì²´ ì„±ê³µë¥ </div><div class="kpi-card-value green" id="kv-success">-<span style="font-size:20px">%</span></div><div class="kpi-card-sub">ìœ íŒœ ê³„ì•½ ì „í™˜ Â· ëª©í‘œ 80%</div><div class="kpi-card-bar"><div class="kpi-card-bar-fill" id="kb-success" style="background:var(--success)"></div></div></div>
  </div>

  <!-- ì „êµ­ëŒ€ë¦¬ì  ì˜ì—… ì§€í‘œ -->
  <div class="section-header">
    <div>
      <div class="section-title">ì „êµ­ëŒ€ë¦¬ì  ì˜ì—… ì§€í‘œ</div>
      <div class="section-sub">ëŒ€ë¦¬ì ëª… ë˜ëŠ” ìˆ«ì í´ë¦­ ì‹œ ì˜ì—…ê³ ê° ë¦¬ìŠ¤íŠ¸ë¡œ ì´ë™</div>
    </div>
    <div class="status-legend-wrap">
      <button class="status-legend-btn" id="legendToggle">ğŸ“Š ìƒíƒœ ê¸°ì¤€ ë³´ê¸° â–¾</button>
      <div class="status-legend-popup" id="legendPopup">
        <div class="legend-title">ğŸ“‹ ìƒíƒœ íŒì • ê¸°ì¤€ (4ê°œ ì§€í‘œ ë‹¬ì„± ìˆ˜)</div>
        <div class="legend-row"><span class="legend-pill pill-excellent">ëª©í‘œë‹¬ì„±</span><div class="legend-desc"><strong>4ê°œ ëª¨ë‘ ë‹¬ì„±</strong><br>1ì°¨ì ‘ì´‰ 1ì¼â†“ Â· 2ì°¨ì ‘ì´‰ 3ì¼â†“ Â· ë°©ë¬¸ìœ¨ 80%â†‘ Â· ì„±ê³µë¥  80%â†‘</div></div>
        <div class="legend-row"><span class="legend-pill pill-good">ìš°ìˆ˜</span><div class="legend-desc"><strong>3ê°œ ë‹¬ì„±</strong></div></div>
        <div class="legend-row"><span class="legend-pill pill-normal">ë³´í†µ</span><div class="legend-desc"><strong>2ê°œ ë‹¬ì„±</strong></div></div>
        <div class="legend-row"><span class="legend-pill pill-warning">ì£¼ì˜</span><div class="legend-desc"><strong>1ê°œ ë‹¬ì„±</strong></div></div>
        <div class="legend-row"><span class="legend-pill pill-danger">ìœ„í—˜</span><div class="legend-desc"><strong>0ê°œ ë‹¬ì„±</strong></div></div>
        <div class="legend-divider"></div>
        <div style="font-size:11px;color:var(--text3);line-height:1.7">ğŸŸ¢ ëª©í‘œë‹¬ì„± &nbsp;|&nbsp; ğŸŸ¡ 75~99% ê·¼ì ‘ &nbsp;|&nbsp; ğŸ”´ 75% ë¯¸ë§Œ<br>âœ± ì„±ê³µë¥  = <strong style="color:var(--text2)">ìœ íŒœ</strong> ê³„ì•½ ê¸°ì¤€</div>
      </div>
    </div>
  </div>
  <div class="dealer-table-wrap">
    <table class="dealer-table">
      <thead><tr>
        <th>ìˆœìœ„</th><th>ëŒ€ë¦¬ì </th>
        <th>1ì°¨ì ‘ì´‰<br><span style="font-weight:400;color:var(--text3);font-size:10px">ëª©í‘œ 1ì¼â†“</span></th>
        <th>2ì°¨ì ‘ì´‰<br><span style="font-weight:400;color:var(--text3);font-size:10px">ëª©í‘œ 3ì¼â†“</span></th>
        <th>ë°©ë¬¸ìœ¨<br><span style="font-weight:400;color:var(--text3);font-size:10px">ëª©í‘œ 80%â†‘</span></th>
        <th>ì„±ê³µë¥ <br><span style="font-weight:400;color:var(--text3);font-size:10px">ëª©í‘œ 80%â†‘</span></th>
        <th>ì˜ì—…ê³ ê°</th><th>ê³„ì•½ ê³ ê°</th><th>ìƒíƒœ</th>
      </tr></thead>
      <tbody id="dealerTbody"></tbody>
    </table>
  </div>
</div>
</div>

<!-- â•â•â•â•â•â• SCREEN 2 â•â•â•â•â•â• -->
<div class="screen" id="screen2">
<div class="main">
  <button class="back-btn" onclick="goScreen(1)">â† ì˜ì—… ëŒ€ì‹œë³´ë“œë¡œ</button>

  <!-- ëŒ€ë¦¬ì  ì§€í‘œë°” (1ì°¨ì ‘ì´‰ Â· 2ì°¨ì ‘ì´‰ Â· ë°©ë¬¸ìœ¨ Â· ì„±ê³µë¥  ìˆœ) -->
  <div class="dealer-info-bar">
    <div class="dib-left">
      <div class="dib-name" id="d2-name"></div>
      <div class="dib-region" id="d2-region"></div>
    </div>
    <div class="dib-kpis">
      <div class="dib-kpi">
        <div class="dib-kpi-v" id="d2-c1" style="color:var(--accent2)">-ì¼</div>
        <div class="dib-kpi-l">1ì°¨ ì ‘ì´‰</div>
        <div class="dib-kpi-goal" id="d2-c1-goal"></div>
      </div>
      <div class="dib-kpi">
        <div class="dib-kpi-v" id="d2-c2" style="color:var(--gold)">-ì¼</div>
        <div class="dib-kpi-l">2ì°¨ ì ‘ì´‰</div>
        <div class="dib-kpi-goal" id="d2-c2-goal"></div>
      </div>
      <div class="dib-kpi">
        <div class="dib-kpi-v" id="d2-visit" style="color:var(--accent)">-</div>
        <div class="dib-kpi-l">ë°©ë¬¸ìœ¨</div>
        <div class="dib-kpi-goal" id="d2-visit-goal"></div>
      </div>
      <div class="dib-kpi">
        <div class="dib-kpi-v" id="d2-success" style="color:var(--success)">-</div>
        <div class="dib-kpi-l">ì„±ê³µë¥ </div>
        <div class="dib-kpi-goal" id="d2-success-goal"></div>
      </div>
    </div>
  </div>

  <!-- í•„í„° -->
  <div class="filter-bar">
    <span style="font-size:12px;color:var(--text3)">ì˜ì—…ìƒíƒœ:</span>
    <button class="filter-btn active" onclick="filterCustomers('all',this)">ì „ì²´</button>
    <button class="filter-btn" onclick="filterCustomers('idle',this)">ë¯¸ì§„í–‰</button>
    <button class="filter-btn" onclick="filterCustomers('active',this)">ì§„í–‰ì¤‘</button>
    <button class="filter-btn" onclick="filterCustomers('success',this)">âœ… ì„±ê³µ</button>
    <button class="filter-btn" onclick="filterCustomers('fail',this)">âŒ ì‹¤íŒ¨</button>
    <button class="filter-btn" onclick="filterCustomers('hold',this)">â¸ ë³´ë¥˜</button>
    <span style="font-size:12px;color:var(--text3);margin-left:8px">ë°©ë¬¸:</span>
    <button class="filter-btn" onclick="filterVisit('all',this)">ì „ì²´</button>
    <button class="filter-btn" onclick="filterVisit('visited',this)">ë°©ë¬¸ì™„ë£Œ</button>
    <button class="filter-btn" onclick="filterVisit('not',this)">ë¯¸ë°©ë¬¸</button>
  </div>

  <!-- ê³ ê° í…Œì´ë¸” -->
  <div class="customer-table-wrap">
    <table class="customer-table">
      <thead><tr>
        <th>ê³ ê°ëª…</th>
        <th>ì•½êµ­ëª…</th>
        <th>ë¬¸ì˜ì¼ì‹œ</th>
        <th>1ì°¨ ì ‘ì´‰</th>
        <th>2ì°¨ ì ‘ì´‰</th>
        <th>ì˜ì—… ì•„ì´í…œ</th>
        <th>ì˜ì—…ë‹¨ê³„</th>
        <th>ë°©ë¬¸ì—¬ë¶€</th>
        <th>ì˜ì—…ìƒíƒœ</th>
        <th>ìœ íŒœ ê³„ì•½</th>
      </tr></thead>
      <tbody id="customerTbody"></tbody>
    </table>
  </div>
</div>
</div>

<!-- â•â•â•â•â•â• SCREEN 3 â•â•â•â•â•â• -->
<div class="screen" id="screen3">
<div class="main">
  <button class="back-btn" onclick="goScreen(2)">â† ì˜ì—…ê³ ê° ë¦¬ìŠ¤íŠ¸ë¡œ</button>
  <div class="customer-detail-grid">

    <!-- ì¢Œ: ê³ ê° ì •ë³´ -->
    <div class="customer-info-card">
      <div class="cust-avatar" id="d3-avatar"></div>
      <div class="cust-name" id="d3-name"></div>
      <div class="cust-pharmacy" id="d3-pharmacy"></div>
      <div class="info-divider"></div>
      <div class="info-row"><span class="info-label">ë‹´ë‹¹ ì˜ì—…ì‚¬ì›</span><span class="info-value" id="d3-sales"></span></div>
      <div class="info-row"><span class="info-label">ë¬¸ì˜ ì±„ë„</span><span class="info-value" id="d3-channel"></span></div>
      <div class="info-row"><span class="info-label">ë¬¸ì˜ ì¼ì‹œ</span><span class="info-value" id="d3-inqdate"></span></div>
      <div class="info-row"><span class="info-label">ì˜ì—…ë‹¨ê³„</span><span class="info-value" id="d3-stage"></span></div>
      <div class="info-row"><span class="info-label">ì˜ì—…ìƒíƒœ</span>
        <div class="status-dropdown-wrap">
          <span class="sales-status" id="d3-status-badge" onclick="toggleStatusDrop('d3-drop')">-</span>
          <div class="status-dropdown" id="d3-drop">
            <div class="status-dropdown-item" onclick="setStatus3('idle')">â¬œ ë¯¸ì§„í–‰</div>
            <div class="status-dropdown-item" onclick="setStatus3('active')">ğŸ”µ ì§„í–‰ì¤‘</div>
            <div class="status-dropdown-item" onclick="setStatus3('success')">âœ… ì„±ê³µ</div>
            <div class="status-dropdown-item" onclick="setStatus3('fail')">âŒ ì‹¤íŒ¨</div>
            <div class="status-dropdown-item" onclick="setStatus3('hold')">â¸ ë³´ë¥˜</div>
          </div>
        </div>
      </div>
      <div class="info-divider"></div>
      <div style="font-size:11px;font-weight:700;color:var(--text3);letter-spacing:.5px;margin-bottom:8px">ì˜ì—… ì•„ì´í…œ</div>
      <div class="item-tags" id="d3-items"></div>
      <div class="kpi-mini-grid">
        <div class="kpi-mini"><div class="kpi-mini-v" id="d3-c1" style="color:var(--accent2)">-</div><div class="kpi-mini-l">1ì°¨ ì ‘ì´‰</div></div>
        <div class="kpi-mini"><div class="kpi-mini-v" id="d3-c2" style="color:var(--gold)">-</div><div class="kpi-mini-l">2ì°¨ ì ‘ì´‰</div></div>
        <div class="kpi-mini"><div class="kpi-mini-v" id="d3-visited" style="color:var(--success)">-</div><div class="kpi-mini-l">ë°©ë¬¸ì—¬ë¶€</div></div>
        <div class="kpi-mini"><div class="kpi-mini-v" id="d3-contract" style="color:var(--accent)">-</div><div class="kpi-mini-l">ìœ íŒœ ê³„ì•½</div></div>
      </div>
    </div>

    <!-- ìš°: ì˜ì—…ì´ë ¥ ìŠ¤ë ˆë“œ -->
    <div class="history-card">
      <div class="history-header">
        <div class="history-title">ğŸ“‹ ì˜ì—… ì´ë ¥</div>
        <span style="font-size:12px;color:var(--text3)" id="d3-contact-count"></span>
      </div>

      <!-- ì´ë ¥ ìŠ¤ë ˆë“œ -->
      <div class="thread-wrap" id="d3-thread"></div>

      <!-- ì´ë ¥ ì…ë ¥ -->
      <div class="history-input-area">
        <div class="history-input-label">âœï¸ ì˜ì—… ì´ë ¥ ë‚¨ê¸°ê¸°</div>
        <textarea class="history-textarea" id="historyInput" rows="3" placeholder="ì˜ˆ: 1ì°¨ ì „í™”ìƒë‹´ ì§„í–‰. ê°€ê²© ë° ê¸°ëŠ¥ ë¬¸ì˜í•˜ì‹¬. ë‹¤ìŒì£¼ ë°©ë¬¸ ìƒë‹´ ì•½ì†í•¨."></textarea>
        <div class="history-input-footer">
          <div class="history-meta-inputs">
            <select class="meta-select" id="historyWriter">
              <option>ì´ì§€í›ˆ</option><option>ìµœí˜„ìš°</option><option>ë°•ì„±ë¯¼</option><option>ê¹€ë„í¬</option>
            </select>
            <select class="meta-select" id="historyVisit">
              <option value="">ë°©ë¬¸ì—¬ë¶€ ë³€ê²½ ì—†ìŒ</option>
              <option value="yes">ë°©ë¬¸ì™„ë£Œë¡œ ë³€ê²½</option>
              <option value="no">ë¯¸ë°©ë¬¸ìœ¼ë¡œ ë³€ê²½</option>
            </select>
            <select class="meta-select" id="historyYuparm">
              <option value="">ìœ íŒœ ê³„ì•½ ë³€ê²½ ì—†ìŒ</option>
              <option value="yes">ê³„ì•½ì™„ë£Œë¡œ ë³€ê²½</option>
              <option value="no">ë¯¸ê³„ì•½ìœ¼ë¡œ ë³€ê²½</option>
            </select>
          </div>
          <button class="history-submit-btn" onclick="addHistory()">ì´ë ¥ ì €ì¥</button>
        </div>
      </div>

      <!-- ë‹¤ìŒ ì•¡ì…˜ -->
      <div class="next-action-box" id="d3-nextaction">
        <div class="nab-title">ğŸ“Œ ë‹¤ìŒ ì•¡ì…˜</div>
        <div class="nab-content" id="d3-nextaction-text">ì´ë ¥ì„ ì €ì¥í•˜ë©´ ìë™ìœ¼ë¡œ ë‹¤ìŒ ì•¡ì…˜ì´ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.</div>
      </div>
    </div>

  </div>
</div>
</div>
</div><!-- /app -->

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ìƒìˆ˜ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const GOAL={c1:1,c2:3,visit:80,success:80};
const DEALER_REGIONS={
  'ìœ ë¹„ê°•ë‚¨':'ê°•ë‚¨Â·ì„œì´ˆÂ·ê°•ë™Â·ì†¡íŒŒÂ·í•˜ë‚¨','ì—ë²„ë„·':'ìˆ˜ì›Â·ì„±ë‚¨Â·ë¶„ë‹¹Â·ìš©ì¸ ì™¸',
  'ì´ì•ˆë©”ë“œ':'ì€í‰Â·ì¼ì‚°Â·ê³ ì–‘Â·íŒŒì£¼Â·ì¢…ë¡œ ì™¸','ì„¸ì¼ë©”ë””íŒœ':'ê°•ë¶Â·ë…¸ì›Â·ë„ë´‰Â·ì˜ì •ë¶€Â·ë‚¨ì–‘ì£¼ ì™¸',
  'ë¹„ì¦ˆí˜„ë©”ë””ì¹¼':'ë¶€ì²œÂ·êµ¬ë¡œÂ·ê¸ˆì²œÂ·ê°•ì„œÂ·ì–‘ì²œ ì™¸','ë””ì¼€ì´íŒœì¼€ì–´':'ëŒ€êµ¬Â·ê²½ì‚°Â·êµ¬ë¯¸Â·ê¹€ì²œÂ·ì•ˆë™ ì™¸',
  'ë””ì›ì¼€ì–´':'ë¶€ì‚°Â·ìš¸ì‚°Â·ì–‘ì‚°','ìœ ë¹„ê²½ì¸':'ì¸ì²œÂ·ì‹œí¥Â·ê¹€í¬Â·ì•ˆì–‘Â·ì•ˆì‚° ì™¸',
  'ë””ë¼ì¸':'ê²½ë‚¨Â·ì°½ì›Â·ê¹€í•´Â·ì§„ì£¼Â·ê±°ì œ ì™¸','ë‘ë¦¬ì•¤íŒœ':'ì „ë‚¨ ì „ì²´Â·ê´‘ì£¼',
  'ë©”ë””ì¼€ì–´':'ì¶©ë¶ ì „ì²´Â·ì„¸ì¢…Â·ì—°ê¸°êµ°','ì˜¬ë°ì´íŒœ':'ì¶©ë‚¨ ì „ì²´Â·ì˜ë™Â·ì˜¥ì²œ',
  'ì´ì˜¤ì•¤íŒœ':'ì „ì£¼Â·ì „ë¶ ì „ì²´','ì•„ì´í¬ì»¤ìŠ¤':'ê°•ì› ì „ì²´','ë™ì›ë©”ë””í…':'í¬í•­Â·ê²½ì£¼Â·ì˜ì²œÂ·ì˜ë•Â·ìš¸ì§„'
};
const DEALER_NAMES=Object.keys(DEALER_REGIONS);
const ADDONS=['ë°´','ì˜¤í† íŒ©','ìœ íŒœí† ìŠ¤í¬ìŠ¤'];
const SALESMEN=['ì´ì§€í›ˆ','ìµœí˜„ìš°','ë°•ì„±ë¯¼','ê¹€ë„í¬'];
const PHARMACY_NAMES=['í–‰ë³µì•½êµ­','ë¯¸ë˜ì•½êµ­','365ì•½êµ­','í•œë§ˆìŒì•½êµ­','ê±´ê°•ì•½êµ­','ë°ì€ì•½êµ­','ìƒˆë²½ì•½êµ­','ì´ë“ ì•½êµ­','ì—°ì„¸ì•½êµ­','ì°¸ì•½êµ­','ì¢‹ì€ì•½êµ­','íŠ¼íŠ¼ì•½êµ­','ë§‘ì€ì•½êµ­','ìƒˆë‚ ì•½êµ­'];
const CHANNELS=['í™ˆí˜ì´ì§€','ì „í™”','ì´ë©”ì¼','SNS','ì§€ì¸ì†Œê°œ','ì „ì‹œíšŒ'];
const SALES_STATUS_MAP={
  idle:{label:'ë¯¸ì§„í–‰',cls:'ss-idle'},
  active:{label:'ì§„í–‰ì¤‘',cls:'ss-active'},
  success:{label:'ì„±ê³µ',cls:'ss-success'},
  fail:{label:'ì‹¤íŒ¨',cls:'ss-fail'},
  hold:{label:'ë³´ë¥˜',cls:'ss-hold'}
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ë‚ ì§œ ìœ í‹¸ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const todayDate=new Date();todayDate.setHours(0,0,0,0);
const fmtDate=d=>d.toISOString().slice(0,10);
const parseDate=s=>{const d=new Date(s);d.setHours(0,0,0,0);return d;};
const daysAgo=n=>{const d=new Date(todayDate);d.setDate(d.getDate()-n);return d;};
const ri=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;
// ë‘ ë‚ ì§œ ê°„ ì¼ ìˆ˜ (ì •ìˆ˜)
function daysBetween(d1Str,d2Str){
  const msPerDay=1000*60*60*24;
  const d1=new Date(d1Str),d2=new Date(d2Str);
  return Math.max(0,Math.round((d2-d1)/msPerDay));
}
// ë‘ ì¼ì‹œ ê°„ í‘œì‹œìš© ë¬¸ìì—´ (0ì¼(Nì‹œê°„), Nì¼)
function elapsedLabel(fromDt,toDt){
  const ms=new Date(toDt)-new Date(fromDt);
  if(ms<0)return '-';
  const totalHours=Math.floor(ms/(1000*60*60));
  const days=Math.floor(totalHours/24);
  const hours=totalHours%24;
  if(days===0)return `0ì¼ (${hours}ì‹œê°„)`;
  return `${days}ì¼`;
}
// ì¼ì‹œ í‘œì‹œ
function fmtDateTime(dt){
  const d=new Date(dt);
  return d.toLocaleDateString('ko-KR',{month:'long',day:'numeric'})+' '+
    d.toLocaleTimeString('ko-KR',{hour:'2-digit',minute:'2-digit'});
}

document.getElementById('dateBadge').textContent=new Date().toLocaleDateString('ko-KR',{year:'numeric',month:'long',day:'numeric'});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ë¡œê·¸ì¸ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let currentRole='dealer',currentDealer='ë‘ë¦¬ì•¤íŒœ';

function selectRole(role,el){
  currentRole=role;
  document.querySelectorAll('.role-tab').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('dealerSelectWrap').style.display=role==='dealer'?'block':'none';
}
function doLogin(){
  const id=document.getElementById('loginId').value.trim();
  const pw=document.getElementById('loginPw').value.trim();
  if(!id||!pw){alert('ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');return;}
  if(currentRole==='dealer'){
    const sel=document.getElementById('dealerSelect').value;
    if(!sel){alert('ëŒ€ë¦¬ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');return;}
    currentDealer=sel;
  } else {currentDealer=null;}
  document.getElementById('loginScreen').style.display='none';
  document.getElementById('app').style.display='block';
  const badge=document.getElementById('roleBadge');
  if(currentRole==='hq'){badge.textContent='ğŸ›ï¸ ë³¸ì‚¬ ê´€ë¦¬ì';badge.className='role-badge hq-badge';document.getElementById('compareSection').style.display='none';}
  else{badge.textContent=currentDealer+' ëŒ€ë¦¬ì ';badge.className='role-badge';document.getElementById('compareSection').style.display='block';}
  fullRefresh();
}
function doLogout(){
  document.getElementById('loginScreen').style.display='flex';
  document.getElementById('app').style.display='none';
  document.getElementById('loginId').value='';document.getElementById('loginPw').value='';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ìƒ˜í”Œ ë°ì´í„° ìƒì„± â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function randItems(){return['ìœ íŒœ',...ADDONS.filter(()=>Math.random()>0.55)];}

// ì˜ì—…ì´ë ¥ ìŠ¤ë ˆë“œ ìƒì„± (ì ‘ìˆ˜ + Nì°¨ ì ‘ì´‰ ì´ë ¥)
// â†’ ê° ì´ë ¥ì€ {contactNo, writer, datetime, text, tags} êµ¬ì¡°
// â†’ contactNo=0: ë¬¸ì˜ì ‘ìˆ˜(CRM ìë™), 1~5: ì˜ì—…ë‹´ë‹¹ì ê¸°ë¡
function makeThreads(inquiryDt, c1DaysOffset, c2DaysOffset, visited, yuparmSuccess, dealerName){
  const threads=[];
  const inqDt=new Date(inquiryDt);
  // 0: ë¬¸ì˜ì ‘ìˆ˜
  threads.push({
    contactNo:0,
    writer:'CRM ìë™',
    datetime:inquiryDt,
    text:'ì‹ ê·œ ë¬¸ì˜ê°€ ì ‘ìˆ˜ë˜ì–´ CRMì— ìë™ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.',
    tags:['ìë™ë“±ë¡'],
    autoEntry:true
  });
  // 1ì°¨ ì ‘ì´‰ ì´ë ¥
  const c1Dt=new Date(inqDt.getTime()+c1DaysOffset*24*60*60*1000);
  c1Dt.setHours(ri(9,18),ri(0,59),0,0);
  threads.push({
    contactNo:1,
    writer:SALESMEN[ri(0,3)],
    datetime:c1Dt.toISOString(),
    text:'ì „í™” ìƒë‹´ ì§„í–‰. ìœ íŒœ ì œí’ˆ ê´€ì‹¬ í™•ì¸ ë° ê¸°ëŠ¥Â·ê°€ê²© ë¬¸ì˜í•˜ì‹¬. ë°©ë¬¸ ë°ëª¨ ì¼ì • í˜‘ì˜.',
    tags:['ì „í™”','1ì°¨ì ‘ì´‰'],
    autoEntry:false
  });
  if(c1DaysOffset>GOAL.c1) threads[threads.length-1].tags.push('ì§€ì—°');
  else threads[threads.length-1].tags.push('ëª©í‘œë‹¬ì„±');
  // 2ì°¨ ì ‘ì´‰ ì´ë ¥
  if(c2DaysOffset>0){
    const c2Dt=new Date(c1Dt.getTime()+c2DaysOffset*24*60*60*1000);
    c2Dt.setHours(ri(9,18),ri(0,59),0,0);
    threads.push({
      contactNo:2,
      writer:SALESMEN[ri(0,3)],
      datetime:c2Dt.toISOString(),
      text: visited
        ? 'ë°©ë¬¸ ìƒë‹´ ì§„í–‰. ìœ íŒœ ë°ëª¨ ì‹œì—° ì™„ë£Œ. ì•½êµ­ ì›ì¥ë‹˜ ë†’ì€ ê´€ì‹¬ í‘œëª…. ë¶€ê°€ ì„œë¹„ìŠ¤ ì¶”ê°€ ì•ˆë‚´.'
        : '2ì°¨ ì „í™” ì§„í–‰. ë°©ë¬¸ ì¼ì • ì¬ì¡°ìœ¨ í•„ìš”. ì›ì¥ ìŠ¤ì¼€ì¤„ë¡œ ë‹¤ìŒ ì£¼ë¡œ ì—°ê¸°.',
      tags:['2ì°¨ì ‘ì´‰', visited?'ë°©ë¬¸':'ì „í™”', c2DaysOffset<=GOAL.c2?'ëª©í‘œë‹¬ì„±':'ì§€ì—°'],
      autoEntry:false
    });
    // ê³„ì•½ ì´ë ¥
    if(yuparmSuccess){
      const cDt=new Date(c2Dt.getTime()+ri(3,8)*24*60*60*1000);
      cDt.setHours(ri(10,16),0,0,0);
      threads.push({
        contactNo:3,
        writer:SALESMEN[ri(0,3)],
        datetime:cDt.toISOString(),
        text:'ìœ íŒœ ê³„ì•½ ì²´ê²° ì™„ë£Œ. ì„¤ì¹˜ ì¼ì • í˜‘ì˜ ë° ë¶€ê°€ ì•„ì´í…œ êµì°¨ ì˜ì—… ì§„í–‰ ì˜ˆì •.',
        tags:['ê³„ì•½ì™„ë£Œ','ìœ íŒœ'],
        autoEntry:false
      });
    }
  }
  return threads;
}

function genCustomers(dealerName,count,c1Range,c2Range,visitRate,successRate){
  return Array.from({length:count},(_,i)=>{
    const daysBack=ri(0,364);
    const inqDate=daysAgo(daysBack);
    inqDate.setHours(ri(8,17),ri(0,59),0,0);
    const inquiryDatetime=inqDate.toISOString();
    const inquiryDate=fmtDate(inqDate);
    const c1Val=Math.round(c1Range[0]+Math.random()*(c1Range[1]-c1Range[0]));
    const c2Val=Math.round(c2Range[0]+Math.random()*(c2Range[1]-c2Range[0]));
    const visited=Math.random()*100<visitRate;
    const yuparmSuccess=visited&&Math.random()*100<successRate;
    const items=randItems();
    // ì˜ì—…ìƒíƒœ ìë™ ê²°ì •
    let salesStatus='active';
    if(yuparmSuccess)salesStatus='success';
    else if(!visited&&c2Val>GOAL.c2*2)salesStatus=Math.random()>0.5?'fail':'hold';
    // ìŠ¤ë ˆë“œ
    const threads=makeThreads(inquiryDatetime,c1Val,c2Val,visited,yuparmSuccess,dealerName);
    // ì ‘ì´‰ ì°¨ìˆ˜ = ë‹´ë‹¹ìê°€ ë‚¨ê¸´ ì´ë ¥ ìˆ˜
    const contactCount=threads.filter(t=>!t.autoEntry).length;
    // 1ì°¨ ì ‘ì´‰ê¸°ê°„ ê³„ì‚°
    const c1Thread=threads.find(t=>t.contactNo===1);
    const c1Elapsed=c1Thread?elapsedLabel(inquiryDatetime,c1Thread.datetime):'-';
    const c1Days=c1Thread?daysBetween(inquiryDate,c1Thread.datetime.slice(0,10)):c1Val;
    // 2ì°¨ ì ‘ì´‰ê¸°ê°„ ê³„ì‚° (1ì°¨â†’2ì°¨)
    const c2Thread=threads.find(t=>t.contactNo===2);
    const c1ThreadDt=c1Thread?c1Thread.datetime:inquiryDatetime;
    const c2Elapsed=c2Thread?elapsedLabel(c1ThreadDt,c2Thread.datetime):'-';
    const c2Days=c2Thread?daysBetween(c1Thread?c1Thread.datetime.slice(0,10):inquiryDate,c2Thread.datetime.slice(0,10)):c2Val;
    return {
      id:i+1,
      name:['ê¹€ë¯¼ì¤€','ì´ì„œì—°','ë°•ì§€í˜¸','ìµœìˆ˜ì•„','ì •íƒœì–‘','í•œë¯¸ë˜','ìœ¤ì„œì¤€','ê°•ì§€ìš°','ì„ì†Œìœ¤','ì¡°í˜„ìš°','ì‹ ì˜ˆì€','ì˜¤ë¯¼ì„','í™©ì§€ìˆ˜','ì•ˆì¬ì›','ë°°ë‹¤ì€','ìœ ìŠ¹í˜„','ë¬¸ì±„ì›','ë…¸ì¤€í˜','ì‹¬ë‚˜ì—°','ì „ë„ìœ¤'][i%20],
      pharmacy:PHARMACY_NAMES[i%PHARMACY_NAMES.length],
      inquiryDatetime, inquiryDate,
      c1Val:c1Days, c2Val:c2Days,
      c1Elapsed, c2Elapsed,
      visited, yuparmSuccess, salesStatus, items,
      contactCount,
      threads,
      sales:SALESMEN[i%4],
      channel:CHANNELS[i%6],
    };
  });
}

const DEALER_WEIGHTS={
  'ìœ ë¹„ê°•ë‚¨':{c1:[0,1],c2:[1,2],visit:91,success:67},'ì—ë²„ë„·':{c1:[0,1],c2:[1,3],visit:88,success:61},
  'ì´ì•ˆë©”ë“œ':{c1:[0,1],c2:[1,3],visit:85,success:58},'ì„¸ì¼ë©”ë””íŒœ':{c1:[0,1],c2:[2,3],visit:82,success:55},
  'ë¹„ì¦ˆí˜„ë©”ë””ì¹¼':{c1:[1,1],c2:[2,4],visit:79,success:51},'ë””ì¼€ì´íŒœì¼€ì–´':{c1:[1,2],c2:[2,4],visit:76,success:49},
  'ë””ì›ì¼€ì–´':{c1:[1,2],c2:[2,4],visit:74,success:46},'ìœ ë¹„ê²½ì¸':{c1:[1,2],c2:[3,5],visit:68,success:44},
  'ë””ë¼ì¸':{c1:[1,2],c2:[3,5],visit:65,success:41},'ë‘ë¦¬ì•¤íŒœ':{c1:[1,3],c2:[3,5],visit:62,success:38},
  'ë©”ë””ì¼€ì–´':{c1:[1,3],c2:[4,5],visit:58,success:35},'ì˜¬ë°ì´íŒœ':{c1:[2,3],c2:[4,6],visit:55,success:32},
  'ì´ì˜¤ì•¤íŒœ':{c1:[2,3],c2:[4,6],visit:51,success:28},'ì•„ì´í¬ì»¤ìŠ¤':{c1:[2,3],c2:[4,6],visit:48,success:25},
  'ë™ì›ë©”ë””í…':{c1:[2,4],c2:[5,7],visit:44,success:21},
};
const allRawCustomers={};
DEALER_NAMES.forEach(n=>{const w=DEALER_WEIGHTS[n];allRawCustomers[n]=genCustomers(n,ri(18,55),w.c1,w.c2,w.visit,w.success);});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ê¸°ê°„/ìƒíƒœ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let filterFrom=daysAgo(90),filterTo=todayDate;
let dealers=[],allCustomers=[],curDealerName=null;
let curCustomer=null;
let visitFilter='all'; // ë°©ë¬¸ í•„í„° ìƒíƒœ

function calcDealerStats(){
  return DEALER_NAMES.map(name=>{
    const filtered=(allRawCustomers[name]||[]).filter(c=>{
      const d=parseDate(c.inquiryDate);return d>=filterFrom&&d<=filterTo;
    });
    const total=filtered.length;
    if(total===0)return{name,region:DEALER_REGIONS[name],visit:0,c1:0,c2:0,success:0,total:0,contract:0};
    const visitedList=filtered.filter(c=>c.visited);
    const contracted=filtered.filter(c=>c.yuparmSuccess);
    const visit=Math.round(visitedList.length/total*100);
    const success=Math.round(contracted.length/total*100);
    const c1=total>0?Math.round(filtered.reduce((s,c)=>s+c.c1Val,0)/total):0;
    const c2=visitedList.length>0?Math.round(visitedList.reduce((s,c)=>s+c.c2Val,0)/visitedList.length):0;
    return{name,region:DEALER_REGIONS[name],visit,c1,c2,success,total,contract:contracted.length};
  });
}
function calcScore(d){
  if(d.total===0)return 0;
  return((d.c1>0?Math.min(100,(GOAL.c1/d.c1)*100):0)+(d.c2>0?Math.min(100,(GOAL.c2/d.c2)*100):0)+Math.min(100,(d.visit/GOAL.visit)*100)+Math.min(100,(d.success/GOAL.success)*100))/4;
}
function refreshDealers(){
  const raw=calcDealerStats();
  raw.forEach(d=>{d.score=calcScore(d);});
  raw.sort((a,b)=>b.score-a.score);
  raw.forEach((d,i)=>{
    d.rank=i+1;
    const met=[d.c1<=GOAL.c1&&d.c1>0,d.c2<=GOAL.c2&&d.c2>0,d.visit>=GOAL.visit,d.success>=GOAL.success].filter(Boolean).length;
    d.status=met===4?'excellent':met===3?'good':met===2?'normal':met===1?'warning':'danger';
  });
  dealers=raw;
}

// â”€â”€â”€ ìƒ‰ìƒ í—¬í¼ â”€â”€â”€
const cC1=v=>v<=GOAL.c1&&v>0?'var(--success)':v>0&&v<=GOAL.c1*1.5?'var(--warning)':'var(--danger)';
const cC2=v=>v<=GOAL.c2&&v>0?'var(--success)':v>0&&v<=GOAL.c2*1.5?'var(--warning)':'var(--danger)';
const cV=v=>v>=GOAL.visit?'var(--success)':v>=GOAL.visit*.75?'var(--warning)':'var(--danger)';
const cS=v=>v>=GOAL.success?'var(--success)':v>=GOAL.success*.75?'var(--warning)':'var(--danger)';
const kC1=v=>v<=GOAL.c1&&v>0?'good':v>0&&v<=GOAL.c1*1.5?'warn':'bad';
const kC2=v=>v<=GOAL.c2&&v>0?'good':v>0&&v<=GOAL.c2*1.5?'warn':'bad';
const kV=v=>v>=GOAL.visit?'good':v>=GOAL.visit*.75?'warn':'bad';
const kS=v=>v>=GOAL.success?'good':v>=GOAL.success*.75?'warn':'bad';
const pClass=s=>({excellent:'pill-excellent',good:'pill-good',normal:'pill-normal',warning:'pill-warning',danger:'pill-danger'}[s]||'pill-normal');
const pText=s=>({excellent:'ëª©í‘œë‹¬ì„±',good:'ìš°ìˆ˜',normal:'ë³´í†µ',warning:'ì£¼ì˜',danger:'ìœ„í—˜'}[s]||'-');
const goalTag=(v,goal,higher)=>higher?(v>=goal?`<span style="font-size:10px;color:var(--success)">â–² ëª©í‘œë‹¬ì„±</span>`:`<span style="font-size:10px;color:var(--warning)">${v}% / ëª©í‘œ ${goal}%</span>`):(v<=goal&&v>0?`<span style="font-size:10px;color:var(--success)">â–² ëª©í‘œë‹¬ì„±</span>`:`<span style="font-size:10px;color:var(--warning)">${v}ì¼ / ëª©í‘œ ${goal}ì¼</span>`);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SCREEN 1 ë Œë” â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function fullRefresh(){
  refreshDealers();renderDealerTable();
  if(currentRole!=='hq')renderCompare();
  renderKpiCards();
  const from=filterFrom.toLocaleDateString('ko-KR',{month:'long',day:'numeric'});
  const to=filterTo.toLocaleDateString('ko-KR',{month:'long',day:'numeric'});
  document.getElementById('periodLabel').textContent=`${from} ~ ${to} ì‹ ê·œ ë¬¸ì˜ ê¸°ì¤€`;
}
function renderKpiCards(){
  const v=dealers.filter(d=>d.total>0);
  const aC1=v.filter(d=>d.c1>0).length>0?Math.round(v.filter(d=>d.c1>0).reduce((s,d)=>s+d.c1,0)/v.filter(d=>d.c1>0).length):0;
  const aC2=v.filter(d=>d.c2>0).length>0?Math.round(v.filter(d=>d.c2>0).reduce((s,d)=>s+d.c2,0)/v.filter(d=>d.c2>0).length):0;
  const aV=v.length>0?Math.round(v.reduce((s,d)=>s+d.visit,0)/v.length):0;
  const aS=v.length>0?Math.round(v.reduce((s,d)=>s+d.success,0)/v.length):0;
  document.getElementById('kv-c1').innerHTML=`${aC1}<span style="font-size:20px">ì¼</span>`;
  document.getElementById('kv-c2').innerHTML=`${aC2}<span style="font-size:20px">ì¼</span>`;
  document.getElementById('kv-visit').innerHTML=`${aV}<span style="font-size:20px">%</span>`;
  document.getElementById('kv-success').innerHTML=`${aS}<span style="font-size:20px">%</span>`;
  document.getElementById('kb-c1').style.width=Math.min(100,aC1>0?(GOAL.c1/aC1)*100:0)+'%';
  document.getElementById('kb-c2').style.width=Math.min(100,aC2>0?(GOAL.c2/aC2)*100:0)+'%';
  document.getElementById('kb-visit').style.width=aV+'%';
  document.getElementById('kb-success').style.width=aS+'%';
}
function renderCompare(){
  const me=dealers.find(d=>d.name===currentDealer)||dealers[dealers.length-1];
  const best=dealers[0];if(!me||!best)return;
  document.getElementById('mineSideLabel').textContent='ğŸ¢ '+me.name+' (ë‚´ ëŒ€ë¦¬ì )';
  document.getElementById('bestSideLabel').textContent='ğŸ† '+best.name+' (Best)';
  const row=(d,cls)=>`
    <div class="kpi-compare-item ${cls}"><div><div class="kci-name">1ì°¨ ì ‘ì´‰ê¸°ê°„</div><div class="kci-sub">ë¬¸ì˜â†’1ì°¨ì´ë ¥ Â· ëª©í‘œ ${GOAL.c1}ì¼</div></div><div style="text-align:right"><div class="kci-value ${kC1(d.c1)}">${d.c1||'-'}ì¼</div></div></div>
    <div class="kpi-compare-item ${cls}"><div><div class="kci-name">2ì°¨ ì ‘ì´‰ê¸°ê°„</div><div class="kci-sub">1ì°¨â†’2ì°¨ì´ë ¥ Â· ëª©í‘œ ${GOAL.c2}ì¼</div></div><div style="text-align:right"><div class="kci-value ${kC2(d.c2)}">${d.c2||'-'}ì¼</div></div></div>
    <div class="kpi-compare-item ${cls}"><div><div class="kci-name">ë°©ë¬¸ìœ¨</div><div class="kci-sub">ë°©ë¬¸ì™„ë£Œ ë¹„ìœ¨ Â· ëª©í‘œ ${GOAL.visit}%</div></div><div style="text-align:right"><div class="kci-value ${kV(d.visit)}">${d.visit}%</div></div></div>
    <div class="kpi-compare-item ${cls}"><div><div class="kci-name">ì„±ê³µë¥  (ìœ íŒœ)</div><div class="kci-sub">ìœ íŒœ ê³„ì•½ ì „í™˜ Â· ëª©í‘œ ${GOAL.success}%</div></div><div style="text-align:right"><div class="kci-value ${kS(d.success)}">${d.success}%</div></div></div>`;
  document.getElementById('mineKpiList').innerHTML=row(me,'highlight-mine');
  document.getElementById('bestKpiList').innerHTML=row(best,'highlight-best');
  const actions=[];
  if(me.c1>GOAL.c1)actions.push(`1ì°¨ ì ‘ì´‰ ${me.c1}ì¼ â†’ ëª©í‘œ ${GOAL.c1}ì¼: ë¬¸ì˜ ë‹¹ì¼ ì´ë ¥ ë“±ë¡ í•„ìˆ˜`);
  if(me.c2>GOAL.c2)actions.push(`2ì°¨ ì ‘ì´‰ ${me.c2}ì¼ â†’ ëª©í‘œ ${GOAL.c2}ì¼: 1ì°¨ ì´í›„ ë¹ ë¥¸ 2ì°¨ ì ‘ì´‰ ì‹¤í–‰`);
  if(me.visit<GOAL.visit)actions.push(`ë°©ë¬¸ìœ¨ ${me.visit}% â†’ ëª©í‘œ ${GOAL.visit}%: ë¯¸ë°©ë¬¸ ê³ ê° ë°©ë¬¸ ì¼ì • í™•ì •`);
  if(me.success<GOAL.success)actions.push(`ì„±ê³µë¥ (ìœ íŒœ) ${me.success}% â†’ ëª©í‘œ ${GOAL.success}%: ì ‘ì´‰ì†ë„ ê°œì„ ì´ í•µì‹¬`);
  if(!actions.length)actions.push('âœ… ëª¨ë“  ëª©í‘œ ë‹¬ì„± ì¤‘! í˜„ì¬ ìˆ˜ì¤€ì„ ìœ ì§€í•˜ì„¸ìš”.');
  document.getElementById('actionItems').innerHTML=actions.map(a=>`<div class="action-item">${a}</div>`).join('');
}
function renderDealerTable(){
  const myName=currentRole==='dealer'?currentDealer:null;
  document.getElementById('dealerTbody').innerHTML=dealers.map(d=>{
    const rc=d.rank===1?'rank-1':d.rank===2?'rank-2':d.rank===3?'rank-3':'rank-n';
    const isMe=d.name===myName;
    return `<tr class="${isMe?'my-row':''}" onclick="goScreen(2,'${d.name}')">
      <td><span class="rank-badge ${rc}">${d.rank}</span></td>
      <td><strong>${d.name}</strong>${isMe?'<span class="my-tag">ë‚´ ëŒ€ë¦¬ì </span>':''}<br><span style="font-size:11px;color:var(--text3)">${d.region}</span></td>
      <td><span style="color:${cC1(d.c1)};font-weight:700">${d.c1}ì¼</span></td>
      <td><span style="color:${cC2(d.c2)};font-weight:700">${d.c2}ì¼</span></td>
      <td><span class="clickable-num" style="color:${cV(d.visit)}" onclick="event.stopPropagation();goScreen(2,'${d.name}')">${d.visit}%</span></td>
      <td><span style="color:${cS(d.success)};font-weight:700">${d.success}%</span></td>
      <td class="clickable-num" onclick="event.stopPropagation();goScreen(2,'${d.name}')">${d.total}ëª…</td>
      <td><strong>${d.contract}</strong>ëª…</td>
      <td><span class="pill ${pClass(d.status)}">${pText(d.status)}</span></td>
    </tr>`;
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SCREEN 2 ë Œë” â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function getCustomers(dealerName){
  return(allRawCustomers[dealerName]||[]).filter(c=>{const d=parseDate(c.inquiryDate);return d>=filterFrom&&d<=filterTo;});
}
// ì˜ì—…ìƒíƒœ ë“œë¡­ë‹¤ìš´ (í…Œì´ë¸” ë‚´)
function toggleStatusDrop(id){
  document.querySelectorAll('.status-dropdown').forEach(el=>{if(el.id!==id)el.classList.remove('open');});
  document.getElementById(id).classList.toggle('open');
}
function setStatusInTable(customerId,newStatus,event){
  event.stopPropagation();
  const c=allCustomers.find(x=>x.id===customerId);
  if(c){c.salesStatus=newStatus;renderCustomerTable(getCurrentFiltered());}
  document.querySelectorAll('.status-dropdown').forEach(el=>el.classList.remove('open'));
}
document.addEventListener('click',()=>document.querySelectorAll('.status-dropdown').forEach(el=>el.classList.remove('open')));

let statusFilter='all';
function getCurrentFiltered(){
  let list=allCustomers;
  if(statusFilter!=='all')list=list.filter(c=>c.salesStatus===statusFilter);
  if(visitFilter==='visited')list=list.filter(c=>c.visited);
  if(visitFilter==='not')list=list.filter(c=>!c.visited);
  return list;
}
function filterCustomers(type,btn){
  document.querySelectorAll('.filter-bar .filter-btn').slice(0,6).forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');statusFilter=type;
  renderCustomerTable(getCurrentFiltered());
}
function filterVisit(type,btn){
  const btns=[...document.querySelectorAll('.filter-bar .filter-btn')].slice(6);
  btns.forEach(b=>b.classList.remove('active'));btn.classList.add('active');visitFilter=type;
  renderCustomerTable(getCurrentFiltered());
}
function renderCustomerTable(customers){
  const contactLabel=['ë¯¸ì§„í–‰','1ì°¨ ì ‘ì´‰','2ì°¨ ì ‘ì´‰','3ì°¨ ì ‘ì´‰','4ì°¨ ì ‘ì´‰','5ì°¨ ì ‘ì´‰'];
  const contactCls=['contact-0','contact-1','contact-2','contact-3','contact-4','contact-5'];
  document.getElementById('customerTbody').innerHTML=customers.map(c=>{
    const stage=Math.min(c.contactCount,5);
    const itags=c.items.map(it=>`<span class="item-micro ${it==='ìœ íŒœ'?'yuparm':'addon'}">${it}</span>`).join('');
    const visitBadge=c.visited?'<span class="visited-yes">ë°©ë¬¸ì™„ë£Œ</span>':'<span class="visited-no">ë¯¸ë°©ë¬¸</span>';
    const contractBadge=c.yuparmSuccess?'<span class="pill pill-excellent" style="font-size:10px">ê³„ì•½ì™„ë£Œ</span>':'<span style="color:var(--text3);font-size:12px">-</span>';
    const ss=SALES_STATUS_MAP[c.salesStatus]||SALES_STATUS_MAP.active;
    const dropId=`drop-${c.id}`;
    return `<tr onclick="goScreen(3,null,null,${c.id})">
      <td><strong>${c.name}</strong></td>
      <td>${c.pharmacy}</td>
      <td style="color:var(--text3);font-size:12px">${c.inquiryDatetime.slice(0,16).replace('T',' ')}</td>
      <td style="font-weight:700">${c.c1Elapsed}</td>
      <td style="font-weight:700">${c.c2Elapsed}</td>
      <td>${itags}</td>
      <td><span class="contact-badge ${contactCls[stage]}">${contactLabel[stage]}</span></td>
      <td>${visitBadge}</td>
      <td>
        <div class="status-dropdown-wrap" onclick="event.stopPropagation()">
          <span class="sales-status ${ss.cls}" onclick="toggleStatusDrop('${dropId}')">${ss.label} â–¾</span>
          <div class="status-dropdown" id="${dropId}">
            <div class="status-dropdown-item" onclick="setStatusInTable(${c.id},'idle',event)">â¬œ ë¯¸ì§„í–‰</div>
            <div class="status-dropdown-item" onclick="setStatusInTable(${c.id},'active',event)">ğŸ”µ ì§„í–‰ì¤‘</div>
            <div class="status-dropdown-item" onclick="setStatusInTable(${c.id},'success',event)">âœ… ì„±ê³µ</div>
            <div class="status-dropdown-item" onclick="setStatusInTable(${c.id},'fail',event)">âŒ ì‹¤íŒ¨</div>
            <div class="status-dropdown-item" onclick="setStatusInTable(${c.id},'hold',event)">â¸ ë³´ë¥˜</div>
          </div>
        </div>
      </td>
      <td>${contractBadge}</td>
    </tr>`;
  }).join('');
}
function renderDealerInfoBar(dealerName){
  const d=dealers.find(x=>x.name===dealerName)||{};
  document.getElementById('d2-name').textContent=dealerName+' ëŒ€ë¦¬ì ';
  document.getElementById('d2-region').textContent=DEALER_REGIONS[dealerName]||'';
  document.getElementById('d2-c1').textContent=(d.c1||0)+'ì¼';
  document.getElementById('d2-c2').textContent=(d.c2||0)+'ì¼';
  document.getElementById('d2-visit').textContent=(d.visit||0)+'%';
  document.getElementById('d2-success').textContent=(d.success||0)+'%';
  document.getElementById('d2-c1-goal').innerHTML=goalTag(d.c1||0,GOAL.c1,false);
  document.getElementById('d2-c2-goal').innerHTML=goalTag(d.c2||0,GOAL.c2,false);
  document.getElementById('d2-visit-goal').innerHTML=goalTag(d.visit||0,GOAL.visit,true);
  document.getElementById('d2-success-goal').innerHTML=goalTag(d.success||0,GOAL.success,true);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SCREEN 3 ë Œë” â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderScreen3(c){
  curCustomer=c;
  document.getElementById('d3-avatar').textContent=c.name[0];
  document.getElementById('d3-name').textContent=c.name;
  document.getElementById('d3-pharmacy').textContent=c.pharmacy;
  document.getElementById('d3-sales').textContent=c.sales;
  document.getElementById('d3-channel').textContent=c.channel;
  document.getElementById('d3-inqdate').textContent=c.inquiryDatetime.slice(0,16).replace('T',' ');
  const contactLabel=['ë¯¸ì§„í–‰','1ì°¨ ì ‘ì´‰','2ì°¨ ì ‘ì´‰','3ì°¨ ì ‘ì´‰','4ì°¨ ì ‘ì´‰','5ì°¨ ì ‘ì´‰'];
  document.getElementById('d3-stage').textContent=contactLabel[Math.min(c.contactCount,5)];
  // ì˜ì—…ìƒíƒœ badge
  updateStatus3Badge(c.salesStatus);
  // ì•„ì´í…œ
  document.getElementById('d3-items').innerHTML=c.items.map(it=>`<span class="item-tag ${it==='ìœ íŒœ'?'yuparm':'addon'}">${it==='ìœ íŒœ'?'â­ ìœ íŒœ':it}</span>`).join('');
  document.getElementById('d3-c1').textContent=c.c1Elapsed;
  document.getElementById('d3-c2').textContent=c.c2Elapsed;
  document.getElementById('d3-visited').textContent=c.visited?'ë°©ë¬¸ì™„ë£Œ':'ë¯¸ë°©ë¬¸';
  document.getElementById('d3-contract').textContent=c.yuparmSuccess?'ê³„ì•½ì™„ë£Œ':'ë¯¸ê³„ì•½';
  // ìŠ¤ë ˆë“œ
  renderThread(c);
  // ë‹¤ìŒ ì•¡ì…˜
  renderNextAction(c);
  document.getElementById('d3-contact-count').textContent=`ì´ ${c.contactCount}ì°¨ ì ‘ì´‰ ì´ë ¥`;
}
function renderThread(c){
  const contactLabel=['ğŸ“‹ ë¬¸ì˜ì ‘ìˆ˜','ğŸ“ 1ì°¨ ì ‘ì´‰','ğŸ“ 2ì°¨ ì ‘ì´‰','ğŸ“ 3ì°¨ ì ‘ì´‰','ğŸ“ 4ì°¨ ì ‘ì´‰','ğŸ“ 5ì°¨ ì ‘ì´‰'];
  const dotCls=['thread-dot-0','thread-dot-1','thread-dot-2','thread-dot-3','thread-dot-4','thread-dot-5'];
  document.getElementById('d3-thread').innerHTML=c.threads.map((t,idx)=>{
    const prevDt=idx===0?null:c.threads[idx-1].datetime;
    const elapsed=prevDt&&!t.autoEntry?`<span class="thread-elapsed">${elapsedLabel(prevDt,t.datetime)} í›„</span>`:'';
    const who=t.autoEntry?'':`<span class="thread-who">${t.writer}</span>`;
    const when=`<span class="thread-when">${fmtDateTime(t.datetime)}</span>`;
    const bodyClass=t.tags.includes('ëª©í‘œë‹¬ì„±')?'good':t.tags.includes('ì§€ì—°')?'warn':'';
    const tags=t.tags.map(tag=>`<span class="thread-tag">${tag}</span>`).join('');
    return `<div class="thread-item">
      <div class="thread-line"></div>
      <div class="thread-dot-wrap ${dotCls[t.contactNo]}">${t.contactNo===0?'ğŸ“¥':t.contactNo}</div>
      <div class="thread-content">
        <div class="thread-meta">
          <span class="thread-contact-label">${contactLabel[t.contactNo]}</span>
          ${who}${when}${elapsed}
        </div>
        <div class="thread-body ${bodyClass}">${t.text}</div>
        <div class="thread-tags">${tags}</div>
      </div>
    </div>`;
  }).join('');
}
function renderNextAction(c){
  const urgent=!c.visited&&c.c2Val>GOAL.c2;
  const box=document.getElementById('d3-nextaction');
  box.style.borderColor=urgent?'rgba(239,68,68,.4)':'rgba(59,130,246,.3)';
  box.style.background=urgent?'rgba(239,68,68,.08)':'rgba(59,130,246,.08)';
  document.getElementById('d3-nextaction-text').textContent=
    c.yuparmSuccess?'ë¶€ê°€ ì•„ì´í…œ êµì°¨ ì˜ì—… ì§„í–‰ (ë°´Â·ì˜¤í† íŒ©Â·ìœ íŒœí† ìŠ¤í¬ìŠ¤)':
    urgent?`ğŸš¨ ì¦‰ì‹œ ë°©ë¬¸ ì¼ì • í™•ì • í•„ìš” (2ì°¨ ì ‘ì´‰ ${c.c2Val}ì¼ ê²½ê³¼)`:
    `${contactLabel2(c.contactCount+1)} ì§„í–‰ ì˜ˆì • â€” ì´ë ¥ì„ ë‚¨ê²¨ ë‹¤ìŒ ì°¨ìˆ˜ë¡œ ì—…ë°ì´íŠ¸í•˜ì„¸ìš”.`;
}
function contactLabel2(n){return['','1ì°¨ ì ‘ì´‰','2ì°¨ ì ‘ì´‰','3ì°¨ ì ‘ì´‰','4ì°¨ ì ‘ì´‰','5ì°¨ ì ‘ì´‰'][Math.min(n,5)]||'ì¶”ê°€ ì ‘ì´‰';}

// ì´ë ¥ ì €ì¥
function addHistory(){
  const text=document.getElementById('historyInput').value.trim();
  if(!text){alert('ì´ë ¥ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');return;}
  const writer=document.getElementById('historyWriter').value;
  const visitChange=document.getElementById('historyVisit').value;
  const yuparmChange=document.getElementById('historyYuparm').value;
  const c=curCustomer;if(!c)return;
  const newContactNo=Math.min(c.contactCount+1,5);
  const now=new Date().toISOString();
  c.threads.push({
    contactNo:newContactNo,writer,datetime:now,text,
    tags:[`${newContactNo}ì°¨ ì ‘ì´‰`],autoEntry:false
  });
  c.contactCount=newContactNo;
  if(visitChange==='yes')c.visited=true;
  if(visitChange==='no')c.visited=false;
  if(yuparmChange==='yes'){c.yuparmSuccess=true;c.salesStatus='success';}
  if(yuparmChange==='no')c.yuparmSuccess=false;
  // ì ‘ì´‰ê¸°ê°„ ì¬ê³„ì‚°
  const c1t=c.threads.find(t=>t.contactNo===1);
  const c2t=c.threads.find(t=>t.contactNo===2);
  c.c1Elapsed=c1t?elapsedLabel(c.inquiryDatetime,c1t.datetime):'-';
  c.c2Elapsed=c2t&&c1t?elapsedLabel(c1t.datetime,c2t.datetime):'-';
  c.c1Val=c1t?daysBetween(c.inquiryDate,c1t.datetime.slice(0,10)):c.c1Val;
  c.c2Val=c2t&&c1t?daysBetween(c1t.datetime.slice(0,10),c2t.datetime.slice(0,10)):c.c2Val;
  // ì´ˆê¸°í™” í›„ ì¬ë Œë”
  document.getElementById('historyInput').value='';
  document.getElementById('historyVisit').value='';
  document.getElementById('historyYuparm').value='';
  renderScreen3(c);
}

// ì˜ì—…ìƒíƒœ (screen3)
function updateStatus3Badge(status){
  const ss=SALES_STATUS_MAP[status]||SALES_STATUS_MAP.active;
  const b=document.getElementById('d3-status-badge');
  b.textContent=ss.label+' â–¾';b.className='sales-status '+ss.cls;
}
function toggleStatusDrop3(id){document.getElementById(id).classList.toggle('open');}
function setStatus3(newStatus){
  if(!curCustomer)return;
  curCustomer.salesStatus=newStatus;
  updateStatus3Badge(newStatus);
  document.getElementById('d3-drop').classList.remove('open');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• í™”ë©´ ì „í™˜ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function goScreen(n,dealerName,_,customerId){
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById('screen'+n).classList.add('active');
  updateBreadcrumb(n,dealerName,customerId);
  if(n===2&&dealerName){
    curDealerName=dealerName;
    allCustomers=getCustomers(dealerName);
    statusFilter='all';visitFilter='all';
    // í•„í„° ë²„íŠ¼ ì´ˆê¸°í™”
    document.querySelectorAll('.filter-bar .filter-btn').forEach((b,i)=>{b.classList.toggle('active',i===0||i===6);});
    renderDealerInfoBar(dealerName);
    renderCustomerTable(allCustomers);
  }
  if(n===3&&customerId){
    const c=allCustomers.find(x=>x.id===customerId);if(!c)return;
    renderScreen3(c);
  }
  window.scrollTo({top:0,behavior:'smooth'});
}
function updateBreadcrumb(n,dealerName,customerId){
  const bc=document.getElementById('breadcrumb');
  if(n===1){bc.innerHTML=`<span class="crumb active">ì˜ì—… ëŒ€ì‹œë³´ë“œ</span>`;}
  else if(n===2){bc.innerHTML=`<span class="crumb" onclick="goScreen(1)">ì˜ì—… ëŒ€ì‹œë³´ë“œ</span><span class="sep">â€º</span><span class="crumb active">${dealerName||curDealerName} ëŒ€ë¦¬ì </span>`;}
  else if(n===3){
    const c=allCustomers.find(x=>x.id===customerId);
    bc.innerHTML=`<span class="crumb" onclick="goScreen(1)">ì˜ì—… ëŒ€ì‹œë³´ë“œ</span><span class="sep">â€º</span><span class="crumb" onclick="goScreen(2)">${curDealerName} ëŒ€ë¦¬ì </span><span class="sep">â€º</span><span class="crumb active">${c?.name||'ê³ ê°ìƒì„¸'}</span>`;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ê¸°ê°„ í•„í„° â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.querySelectorAll('.period-btn[data-period]').forEach(btn=>{
  btn.addEventListener('click',function(){
    document.querySelectorAll('.period-btn[data-period]').forEach(b=>b.classList.remove('active'));
    this.classList.add('active');filterFrom=daysAgo(parseInt(this.dataset.period));filterTo=todayDate;
    document.getElementById('dateFrom').value='';document.getElementById('dateTo').value='';
    fullRefresh();
  });
});
document.getElementById('customApplyBtn').addEventListener('click',function(){
  const from=document.getElementById('dateFrom').value,to=document.getElementById('dateTo').value;
  if(!from||!to){alert('ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');return;}
  if(from>to){alert('ì‹œì‘ì¼ì´ ì¢…ë£Œì¼ë³´ë‹¤ ëŠ¦ìŠµë‹ˆë‹¤.');return;}
  document.querySelectorAll('.period-btn[data-period]').forEach(b=>b.classList.remove('active'));
  filterFrom=parseDate(from);filterTo=parseDate(to);fullRefresh();
});

// ë²”ë¡€ íŒì—…
document.getElementById('legendToggle').addEventListener('click',function(e){
  e.stopPropagation();document.getElementById('legendPopup').classList.toggle('show');
});
document.addEventListener('click',()=>document.getElementById('legendPopup').classList.remove('show'));
</script>
</body>
</html>
