<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì˜ì—… CRM ëŒ€ì‹œë³´ë“œ | UBì¼€ì–´</title>
<link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0e1a;
    --surface: #111827;
    --surface2: #1a2235;
    --border: #1f2d45;
    --accent: #3b82f6;
    --accent2: #06b6d4;
    --success: #10b981;
    --warning: #f59e0b;
    --danger: #ef4444;
    --text: #f1f5f9;
    --text2: #94a3b8;
    --text3: #64748b;
    --gold: #f59e0b;
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body {
    font-family: 'Pretendard', -apple-system, sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* â”€â”€ ê³µí†µ â”€â”€ */
  .screen { display:none; animation: fadeIn 0.35s ease; }
  .screen.active { display:block; }
  @keyframes fadeIn { from { opacity:0; transform:translateY(12px); } to { opacity:1; transform:translateY(0); } }

  /* â”€â”€ í—¤ë” â”€â”€ */
  header {
    position: sticky; top:0; z-index:100;
    background: rgba(10,14,26,0.92);
    backdrop-filter: blur(16px);
    border-bottom: 1px solid var(--border);
    padding: 0 32px;
    height: 60px;
    display: flex; align-items: center; justify-content: space-between;
  }
  .logo { font-size: 17px; font-weight: 800; letter-spacing: -0.5px; }
  .logo span { color: var(--accent); }
  .breadcrumb { display:flex; align-items:center; gap:8px; font-size:13px; color:var(--text3); }
  .breadcrumb .crumb { cursor:pointer; transition:color .2s; }
  .breadcrumb .crumb:hover { color:var(--text); }
  .breadcrumb .crumb.active { color:var(--text); font-weight:600; }
  .breadcrumb .sep { color:var(--border); }
  .header-right { display:flex; align-items:center; gap:16px; }
  .role-badge {
    font-size:11px; font-weight:700; padding:4px 10px;
    border-radius:20px; letter-spacing:.5px;
    background: rgba(59,130,246,0.15); color: var(--accent);
    border: 1px solid rgba(59,130,246,0.3);
  }
  .date-badge { font-size:12px; color:var(--text3); }

  /* â”€â”€ ë©”ì¸ â”€â”€ */
  .main { max-width: 1400px; margin:0 auto; padding: 32px; }

  /* â”€â”€ DEPTH 1: ëŒ€ì‹œë³´ë“œ â”€â”€ */
  .page-title { font-size:24px; font-weight:800; letter-spacing:-0.5px; margin-bottom:4px; }
  .page-sub { font-size:13px; color:var(--text3); margin-bottom:32px; }

  /* ë‚´ ëŒ€ë¦¬ì  vs Best ë¹„êµ ì„¹ì…˜ */
  .compare-section {
    background: linear-gradient(135deg, #0f1c3a 0%, #0a1628 100%);
    border: 1px solid rgba(59,130,246,0.25);
    border-radius: 16px;
    padding: 28px;
    margin-bottom: 28px;
    position: relative;
    overflow: hidden;
  }
  .compare-section::before {
    content:'';
    position:absolute; top:0; left:0; right:0; height:2px;
    background: linear-gradient(90deg, var(--accent), var(--accent2));
  }
  .compare-title { font-size:13px; font-weight:700; color:var(--accent2); letter-spacing:1px; text-transform:uppercase; margin-bottom:20px; }
  .compare-grid { display:grid; grid-template-columns:1fr 40px 1fr; gap:0; align-items:start; }
  .compare-side { }
  .compare-label { font-size:11px; font-weight:700; letter-spacing:1px; text-transform:uppercase; margin-bottom:16px; }
  .compare-label.mine { color:var(--accent); }
  .compare-label.best { color:var(--gold); }
  .compare-divider { display:flex; align-items:center; justify-content:center; padding-top:30px; color:var(--text3); font-size:11px; font-weight:700; }

  .kpi-compare-list { display:flex; flex-direction:column; gap:10px; }
  .kpi-compare-item {
    display:flex; align-items:center; justify-content:space-between;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius:10px;
    padding:12px 16px;
  }
  .kpi-compare-item.highlight-mine { border-color:rgba(59,130,246,0.4); }
  .kpi-compare-item.highlight-best { border-color:rgba(245,158,11,0.4); }
  .kci-name { font-size:12px; color:var(--text2); }
  .kci-value { font-size:20px; font-weight:800; letter-spacing:-0.5px; }
  .kci-value.good { color: var(--success); }
  .kci-value.warn { color: var(--warning); }
  .kci-value.bad { color: var(--danger); }
  .kci-sub { font-size:11px; color:var(--text3); margin-top:2px; }

  /* ì•¡ì…˜ ê°€ì´ë“œ */
  .action-guide {
    margin-top:20px;
    background: rgba(239,68,68,0.08);
    border: 1px solid rgba(239,68,68,0.25);
    border-radius:10px;
    padding:16px 20px;
  }
  .action-guide.green {
    background: rgba(16,185,129,0.08);
    border-color: rgba(16,185,129,0.25);
  }
  .action-guide-title { font-size:11px; font-weight:700; letter-spacing:1px; color:var(--danger); margin-bottom:8px; }
  .action-guide.green .action-guide-title { color:var(--success); }
  .action-items { display:flex; flex-direction:column; gap:6px; }
  .action-item { font-size:13px; color:var(--text); display:flex; align-items:flex-start; gap:8px; }
  .action-item::before { content:'â†’'; color:var(--danger); flex-shrink:0; }
  .action-guide.green .action-item::before { color:var(--success); }

  /* ì „ì²´ í•µì‹¬ KPI ì¹´ë“œ */
  .kpi-row { display:grid; grid-template-columns:repeat(4,1fr); gap:16px; margin-bottom:28px; }
  .kpi-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius:14px;
    padding:20px 22px;
    position:relative;
    overflow:hidden;
    transition: transform .2s, border-color .2s;
    cursor:default;
  }
  .kpi-card:hover { transform:translateY(-2px); border-color:rgba(59,130,246,0.4); }
  .kpi-card-icon { font-size:22px; margin-bottom:12px; }
  .kpi-card-label { font-size:11px; font-weight:700; letter-spacing:1px; color:var(--text3); text-transform:uppercase; margin-bottom:8px; }
  .kpi-card-value { font-size:34px; font-weight:900; letter-spacing:-1px; line-height:1; }
  .kpi-card-value.blue { color:var(--accent); }
  .kpi-card-value.cyan { color:var(--accent2); }
  .kpi-card-value.green { color:var(--success); }
  .kpi-card-value.gold { color:var(--gold); }
  .kpi-card-sub { font-size:12px; color:var(--text3); margin-top:8px; }
  .kpi-card-bar { height:3px; background:var(--border); border-radius:2px; margin-top:14px; overflow:hidden; }
  .kpi-card-bar-fill { height:100%; border-radius:2px; transition:width 1s ease; }

  /* ì „êµ­ ëŒ€ë¦¬ì  í…Œì´ë¸” */
  .section-title { font-size:16px; font-weight:800; margin-bottom:4px; }
  .section-sub { font-size:12px; color:var(--text3); margin-bottom:20px; }
  .dealer-table-wrap {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius:14px;
    overflow:hidden;
    margin-bottom:28px;
  }
  .dealer-table { width:100%; border-collapse:collapse; }
  .dealer-table thead tr {
    background: var(--surface2);
    border-bottom: 1px solid var(--border);
  }
  .dealer-table th {
    padding:12px 16px;
    text-align:left;
    font-size:11px; font-weight:700; letter-spacing:1px;
    color:var(--text3); text-transform:uppercase;
    white-space:nowrap;
  }
  .dealer-table th.right { text-align:right; }
  .dealer-table tbody tr {
    border-bottom: 1px solid rgba(31,45,69,0.5);
    transition: background .15s;
    cursor:pointer;
  }
  .dealer-table tbody tr:last-child { border-bottom:none; }
  .dealer-table tbody tr:hover { background: var(--surface2); }
  .dealer-table td { padding:14px 16px; font-size:13px; vertical-align:middle; }
  .dealer-table td.right { text-align:right; }
  .rank-badge {
    display:inline-flex; align-items:center; justify-content:center;
    width:24px; height:24px; border-radius:6px;
    font-size:12px; font-weight:800;
  }
  .rank-1 { background:rgba(245,158,11,0.2); color:var(--gold); }
  .rank-2 { background:rgba(148,163,184,0.15); color:#94a3b8; }
  .rank-3 { background:rgba(180,120,60,0.15); color:#cd7f32; }
  .rank-n { background:rgba(31,45,69,0.8); color:var(--text3); }
  .my-row { background: rgba(59,130,246,0.05) !important; }
  .my-tag {
    display:inline-block;
    font-size:10px; font-weight:700;
    padding:2px 6px; border-radius:4px;
    background:rgba(59,130,246,0.2); color:var(--accent);
    margin-left:6px;
  }
  .score-bar-wrap { display:flex; align-items:center; gap:8px; }
  .score-bar { flex:1; height:6px; background:var(--border); border-radius:3px; overflow:hidden; max-width:80px; }
  .score-bar-fill { height:100%; border-radius:3px; }
  .pill {
    display:inline-block; padding:3px 8px; border-radius:20px;
    font-size:11px; font-weight:700;
  }
  .pill-green { background:rgba(16,185,129,0.15); color:var(--success); }
  .pill-yellow { background:rgba(245,158,11,0.15); color:var(--warning); }
  .pill-red { background:rgba(239,68,68,0.15); color:var(--danger); }
  .clickable-num {
    font-weight:700; color:var(--accent);
    cursor:pointer; text-decoration:underline;
    text-decoration-color:rgba(59,130,246,0.3);
    text-underline-offset:3px;
    transition:color .2s;
  }
  .clickable-num:hover { color:var(--accent2); }

  /* â”€â”€ DEPTH 2: ê³ ê° ë¦¬ìŠ¤íŠ¸ â”€â”€ */
  .back-btn {
    display:inline-flex; align-items:center; gap:8px;
    font-size:13px; font-weight:600; color:var(--text3);
    cursor:pointer; margin-bottom:24px;
    transition:color .2s;
    background:none; border:none;
  }
  .back-btn:hover { color:var(--text); }
  .dealer-info-bar {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius:12px;
    padding:20px 24px;
    margin-bottom:24px;
    display:flex; align-items:center; justify-content:space-between;
  }
  .dib-left { }
  .dib-name { font-size:20px; font-weight:800; margin-bottom:4px; }
  .dib-meta { font-size:12px; color:var(--text3); }
  .dib-kpis { display:flex; gap:32px; }
  .dib-kpi { text-align:center; }
  .dib-kpi-v { font-size:22px; font-weight:800; }
  .dib-kpi-l { font-size:11px; color:var(--text3); margin-top:2px; }

  .filter-bar {
    display:flex; align-items:center; gap:12px;
    margin-bottom:20px; flex-wrap:wrap;
  }
  .filter-btn {
    padding:6px 14px; border-radius:20px;
    font-size:12px; font-weight:600;
    border: 1px solid var(--border);
    background:var(--surface); color:var(--text2);
    cursor:pointer; transition: all .2s;
  }
  .filter-btn:hover, .filter-btn.active { background:var(--accent); color:#fff; border-color:var(--accent); }

  .customer-table-wrap {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius:14px;
    overflow:hidden;
  }
  .customer-table { width:100%; border-collapse:collapse; }
  .customer-table thead tr {
    background: var(--surface2);
    border-bottom: 1px solid var(--border);
  }
  .customer-table th {
    padding:12px 16px; text-align:left;
    font-size:11px; font-weight:700; letter-spacing:1px;
    color:var(--text3); text-transform:uppercase; white-space:nowrap;
  }
  .customer-table tbody tr {
    border-bottom: 1px solid rgba(31,45,69,0.5);
    cursor:pointer; transition:background .15s;
  }
  .customer-table tbody tr:last-child { border-bottom:none; }
  .customer-table tbody tr:hover { background:var(--surface2); }
  .customer-table td { padding:14px 16px; font-size:13px; vertical-align:middle; }
  .stage-badge {
    display:inline-block; padding:3px 10px; border-radius:20px;
    font-size:11px; font-weight:700;
  }
  .stage-1 { background:rgba(59,130,246,0.15); color:var(--accent); }
  .stage-2 { background:rgba(6,182,212,0.15); color:var(--accent2); }
  .stage-3 { background:rgba(245,158,11,0.15); color:var(--warning); }
  .stage-4 { background:rgba(16,185,129,0.15); color:var(--success); }
  .stage-5 { background:rgba(239,68,68,0.15); color:var(--danger); }
  .contact-speed {
    display:flex; align-items:center; gap:6px; font-size:12px;
  }
  .speed-dot { width:8px; height:8px; border-radius:50%; }

  /* â”€â”€ DEPTH 3: ê³ ê° ìƒì„¸ â”€â”€ */
  .customer-detail-grid { display:grid; grid-template-columns:340px 1fr; gap:24px; }
  .customer-info-card {
    background:var(--surface);
    border:1px solid var(--border);
    border-radius:14px;
    padding:24px;
    height:fit-content;
    position:sticky; top:80px;
  }
  .cust-avatar {
    width:56px; height:56px; border-radius:14px;
    background:linear-gradient(135deg,var(--accent),var(--accent2));
    display:flex; align-items:center; justify-content:center;
    font-size:22px; font-weight:800; margin-bottom:16px;
  }
  .cust-name { font-size:20px; font-weight:800; margin-bottom:4px; }
  .cust-hospital { font-size:13px; color:var(--text2); margin-bottom:16px; }
  .info-divider { height:1px; background:var(--border); margin:16px 0; }
  .info-row { display:flex; justify-content:space-between; margin-bottom:10px; font-size:13px; }
  .info-label { color:var(--text3); }
  .info-value { font-weight:600; }
  .kpi-mini-grid { display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:16px; }
  .kpi-mini {
    background:var(--surface2); border-radius:10px; padding:12px;
    text-align:center;
  }
  .kpi-mini-v { font-size:18px; font-weight:800; }
  .kpi-mini-l { font-size:10px; color:var(--text3); margin-top:3px; }

  /* íƒ€ì„ë¼ì¸ */
  .timeline-card {
    background:var(--surface);
    border:1px solid var(--border);
    border-radius:14px;
    padding:24px;
  }
  .timeline-title { font-size:16px; font-weight:800; margin-bottom:20px; }
  .timeline { position:relative; padding-left:24px; }
  .timeline::before {
    content:''; position:absolute; left:8px; top:0; bottom:0;
    width:2px; background:var(--border);
  }
  .tl-item { position:relative; margin-bottom:24px; }
  .tl-item:last-child { margin-bottom:0; }
  .tl-dot {
    position:absolute; left:-20px; top:2px;
    width:14px; height:14px; border-radius:50%;
    border:2px solid var(--bg);
  }
  .tl-dot-blue { background:var(--accent); }
  .tl-dot-cyan { background:var(--accent2); }
  .tl-dot-green { background:var(--success); }
  .tl-dot-gold { background:var(--gold); }
  .tl-dot-red { background:var(--danger); }
  .tl-date { font-size:11px; color:var(--text3); margin-bottom:4px; }
  .tl-title { font-size:14px; font-weight:700; margin-bottom:6px; }
  .tl-content {
    font-size:13px; color:var(--text2); line-height:1.6;
    background:var(--surface2); border-radius:8px; padding:12px 14px;
    border-left:3px solid var(--border);
  }
  .tl-meta { display:flex; gap:12px; margin-top:8px; }
  .tl-tag {
    font-size:11px; padding:2px 8px; border-radius:4px;
    background:var(--border); color:var(--text3); font-weight:600;
  }
  .tl-result-good { border-left-color:var(--success) !important; }
  .tl-result-warn { border-left-color:var(--warning) !important; }
  .tl-result-bad { border-left-color:var(--danger) !important; }

  .next-action-box {
    background:rgba(59,130,246,0.08);
    border:1px solid rgba(59,130,246,0.3);
    border-radius:10px;
    padding:16px 20px;
    margin-top:20px;
  }
  .nab-title { font-size:11px; font-weight:700; letter-spacing:1px; color:var(--accent); margin-bottom:8px; text-transform:uppercase; }
  .nab-content { font-size:13px; color:var(--text); line-height:1.5; }

  /* â”€â”€ ê¸°ê°„ í•„í„° â”€â”€ */
  .period-filter-bar {
    display: flex; align-items: center; gap: 8px; flex-wrap: wrap;
  }
  .period-btn {
    padding: 7px 14px; border-radius: 8px;
    font-size: 12px; font-weight: 700;
    border: 1px solid var(--border);
    background: var(--surface); color: var(--text2);
    cursor: pointer; transition: all .2s; white-space: nowrap;
    font-family: 'Pretendard', sans-serif;
  }
  .period-btn:hover { border-color: var(--accent); color: var(--accent); }
  .period-btn.active { background: var(--accent); color: #fff; border-color: var(--accent); }
  .period-custom-wrap {
    display: flex; align-items: center; gap: 6px;
    background: var(--surface); border: 1px solid var(--border);
    border-radius: 8px; padding: 4px 10px;
  }
  .date-input {
    background: transparent; border: none; outline: none;
    color: var(--text); font-size: 12px; font-family: 'Pretendard', sans-serif;
    cursor: pointer; width: 110px;
  }
  .date-input::-webkit-calendar-picker-indicator { filter: invert(0.6); cursor: pointer; }

  /* â”€â”€ ë°˜ì‘í˜• â”€â”€ */
  @media(max-width:900px){
    .main { padding:16px; }
    .kpi-row { grid-template-columns:repeat(2,1fr); }
    .compare-grid { grid-template-columns:1fr; }
    .compare-divider { display:none; }
    .customer-detail-grid { grid-template-columns:1fr; }
    .dib-kpis { gap:16px; }
  }
</style>
</head>
<body>

<!-- HEADER -->
<header>
  <div class="logo">UB<span>CARE</span> ì˜ì—…CRM</div>
  <div class="breadcrumb" id="breadcrumb">
    <span class="crumb active" onclick="goScreen(1)">ì „ì²´ ëŒ€ì‹œë³´ë“œ</span>
  </div>
  <div class="header-right">
    <span class="role-badge" id="roleBadge">ë‘ë¦¬ì•¤íŒœ ëŒ€ë¦¬ì </span>
    <span class="date-badge" id="dateBadge"></span>
  </div>
</header>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SCREEN 1 -->
<div class="screen active" id="screen1">
<div class="main">
  <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px;margin-bottom:24px;">
    <div>
      <div class="page-title">ì˜ì—… ì„±ê³¼ ëŒ€ì‹œë³´ë“œ</div>
      <div class="page-sub" id="periodLabel">ê¸°ê°„ ë¡œë”© ì¤‘...</div>
    </div>
    <div class="period-filter-bar">
      <button class="period-btn" data-period="7">ìµœê·¼ 7ì¼</button>
      <button class="period-btn" data-period="30">ìµœê·¼ 30ì¼</button>
      <button class="period-btn active" data-period="90">ìµœê·¼ 3ê°œì›”</button>
      <button class="period-btn" data-period="180">ìµœê·¼ 6ê°œì›”</button>
      <button class="period-btn" data-period="365">ìµœê·¼ 1ë…„</button>
      <div class="period-custom-wrap">
        <input type="date" id="dateFrom" class="date-input">
        <span style="color:var(--text3);font-size:12px">~</span>
        <input type="date" id="dateTo" class="date-input">
        <button class="period-btn" id="customApplyBtn">ì ìš©</button>
      </div>
    </div>
  </div>

  <!-- ë‚´ ëŒ€ë¦¬ì  vs Best ë¹„êµ -->
  <div class="compare-section">
    <div class="compare-title">âš¡ ë‚´ ëŒ€ë¦¬ì  vs Best ëŒ€ë¦¬ì  í•µì‹¬ ì§€í‘œ ë¹„êµ</div>
    <div class="compare-grid">
      <!-- ë‚´ ëŒ€ë¦¬ì  -->
      <div class="compare-side">
        <div class="compare-label mine">ğŸ¢ ë‘ë¦¬ì•¤íŒœ (ë‚´ ëŒ€ë¦¬ì )</div>
        <div class="kpi-compare-list">
          <div class="kpi-compare-item highlight-mine">
            <div><div class="kci-name">1ì°¨ ì ‘ì´‰ê¸°ê°„</div><div class="kci-sub">ë¬¸ì˜â†’ì „í™” í‰ê· </div></div>
            <div style="text-align:right"><div class="kci-value warn">1.8ì¼</div></div>
          </div>
          <div class="kpi-compare-item highlight-mine">
            <div><div class="kci-name">2ì°¨ ì ‘ì´‰ê¸°ê°„</div><div class="kci-sub">ì „í™”â†’ë°©ë¬¸ í‰ê· </div></div>
            <div style="text-align:right"><div class="kci-value bad">4.2ì¼</div></div>
          </div>
          <div class="kpi-compare-item highlight-mine">
            <div><div class="kci-name">ë°©ë¬¸ìœ¨</div><div class="kci-sub">ì „í™” í›„ ë°©ë¬¸ ì „í™˜</div></div>
            <div style="text-align:right"><div class="kci-value warn">62%</div></div>
          </div>
          <div class="kpi-compare-item highlight-mine">
            <div><div class="kci-name">ì„±ê³µë¥ </div><div class="kci-sub">ê³„ì•½ ì „í™˜ìœ¨</div></div>
            <div style="text-align:right"><div class="kci-value warn">38%</div></div>
          </div>
        </div>
      </div>
      <div class="compare-divider">VS</div>
      <!-- Best ëŒ€ë¦¬ì  -->
      <div class="compare-side">
        <div class="compare-label best">ğŸ† ìœ ë¹„ê°•ë‚¨ (Best)</div>
        <div class="kpi-compare-list">
          <div class="kpi-compare-item highlight-best">
            <div><div class="kci-name">1ì°¨ ì ‘ì´‰ê¸°ê°„</div><div class="kci-sub">ë¬¸ì˜â†’ì „í™” í‰ê· </div></div>
            <div style="text-align:right"><div class="kci-value good">0.3ì¼</div></div>
          </div>
          <div class="kpi-compare-item highlight-best">
            <div><div class="kci-name">2ì°¨ ì ‘ì´‰ê¸°ê°„</div><div class="kci-sub">ì „í™”â†’ë°©ë¬¸ í‰ê· </div></div>
            <div style="text-align:right"><div class="kci-value good">2.1ì¼</div></div>
          </div>
          <div class="kpi-compare-item highlight-best">
            <div><div class="kci-name">ë°©ë¬¸ìœ¨</div><div class="kci-sub">ì „í™” í›„ ë°©ë¬¸ ì „í™˜</div></div>
            <div style="text-align:right"><div class="kci-value good">91%</div></div>
          </div>
          <div class="kpi-compare-item highlight-best">
            <div><div class="kci-name">ì„±ê³µë¥ </div><div class="kci-sub">ê³„ì•½ ì „í™˜ìœ¨</div></div>
            <div style="text-align:right"><div class="kci-value good">67%</div></div>
          </div>
        </div>
      </div>
    </div>

    <!-- ì•¡ì…˜ ê°€ì´ë“œ -->
    <div class="action-guide">
      <div class="action-guide-title">ğŸš¨ ì§€ê¸ˆ ë°”ë¡œ í•´ì•¼ í•  ì¼</div>
      <div class="action-items">
        <div class="action-item">ë°©ë¬¸ìœ¨ 62% â†’ ëª©í‘œ 90%: ì•„ì§ ë°©ë¬¸ ì•ˆ ëœ ê³ ê° <span class="clickable-num" onclick="goScreen(2,'ë‘ë¦¬ì•¤íŒœ',true)">14ëª…</span> ì˜¤ëŠ˜ ì¤‘ ë°©ë¬¸ ì¼ì • í™•ì •í•˜ì„¸ìš”</div>
        <div class="action-item">2ì°¨ ì ‘ì´‰ê¸°ê°„ 4.2ì¼ â†’ ëª©í‘œ 3ì¼ ì´ë‚´: ì „í™” í›„ ë°©ë¬¸ ì§€ì—° ê³ ê° <span class="clickable-num" onclick="goScreen(2,'ë‘ë¦¬ì•¤íŒœ',true)">8ëª…</span> ì¦‰ì‹œ ë°©ë¬¸ ì‹¤í–‰</div>
        <div class="action-item">1ì°¨ ì ‘ì´‰ 1.8ì¼ â†’ ëª©í‘œ ë‹¹ì¼: ì‹ ê·œ ë¬¸ì˜ ì¦‰ì‹œ ì „í™” ì‘ëŒ€ ìŠµê´€í™” (Best ëŒ€ë¦¬ì  0.3ì¼ ë‹¬ì„± ì¤‘)</div>
      </div>
    </div>
  </div>

  <!-- ì „ì‚¬ KPI ì¹´ë“œ -->
  <div class="kpi-row">
    <div class="kpi-card">
      <div class="kpi-card-icon">âš¡</div>
      <div class="kpi-card-label">1ì°¨ ì ‘ì´‰ í‰ê· </div>
      <div class="kpi-card-value cyan">1.2<span style="font-size:20px">ì¼</span></div>
      <div class="kpi-card-sub">ë¬¸ì˜â†’ì „í™” Â· ëª©í‘œ ë‹¹ì¼</div>
      <div class="kpi-card-bar"><div class="kpi-card-bar-fill" style="width:60%;background:var(--accent2)"></div></div>
    </div>
    <div class="kpi-card">
      <div class="kpi-card-icon">ğŸ“…</div>
      <div class="kpi-card-label">2ì°¨ ì ‘ì´‰ í‰ê· </div>
      <div class="kpi-card-value gold">3.1<span style="font-size:20px">ì¼</span></div>
      <div class="kpi-card-sub">ì „í™”â†’ë°©ë¬¸ Â· ëª©í‘œ 3ì¼</div>
      <div class="kpi-card-bar"><div class="kpi-card-bar-fill" style="width:68%;background:var(--gold)"></div></div>
    </div>
    <div class="kpi-card">
      <div class="kpi-card-icon">ğŸƒ</div>
      <div class="kpi-card-label">ì „ì²´ ë°©ë¬¸ìœ¨</div>
      <div class="kpi-card-value blue">74<span style="font-size:20px">%</span></div>
      <div class="kpi-card-sub">ì „êµ­ í‰ê·  Â· ëª©í‘œ 90%</div>
      <div class="kpi-card-bar"><div class="kpi-card-bar-fill" style="width:74%;background:var(--accent)"></div></div>
    </div>
    <div class="kpi-card">
      <div class="kpi-card-icon">âœ…</div>
      <div class="kpi-card-label">ì „ì²´ ì„±ê³µë¥ </div>
      <div class="kpi-card-value green">52<span style="font-size:20px">%</span></div>
      <div class="kpi-card-sub">ê³„ì•½ ì „í™˜ Â· ëª©í‘œ 60%</div>
      <div class="kpi-card-bar"><div class="kpi-card-bar-fill" style="width:52%;background:var(--success)"></div></div>
    </div>
  </div>

  <!-- ì „êµ­ ëŒ€ë¦¬ì  ìˆœìœ„ -->
  <div class="section-title">ì „êµ­ 15ê°œ ëŒ€ë¦¬ì  í•µì‹¬ì§€í‘œ</div>
  <div class="section-sub">ìˆ«ìë¥¼ í´ë¦­í•˜ë©´ í•´ë‹¹ ëŒ€ë¦¬ì ì˜ ê³ ê° ë¦¬ìŠ¤íŠ¸ë¡œ ì´ë™í•©ë‹ˆë‹¤</div>
  <div class="dealer-table-wrap">
    <table class="dealer-table" id="dealerTable">
      <thead>
        <tr>
          <th>ìˆœìœ„</th>
          <th>ëŒ€ë¦¬ì </th>
          <th>1ì°¨ì ‘ì´‰</th>
          <th>2ì°¨ì ‘ì´‰</th>
          <th>ë°©ë¬¸ìœ¨</th>
          <th>ì„±ê³µë¥ </th>
          <th>ë‹´ë‹¹ê³ ê°</th>
          <th>ê³„ì•½ê±´</th>
          <th>ìƒíƒœ</th>
        </tr>
      </thead>
      <tbody id="dealerTbody"></tbody>
    </table>
  </div>
</div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SCREEN 2 -->
<div class="screen" id="screen2">
<div class="main">
  <button class="back-btn" onclick="goScreen(1)">â† ì „ì²´ ëŒ€ì‹œë³´ë“œë¡œ</button>

  <div class="dealer-info-bar">
    <div class="dib-left">
      <div class="dib-name" id="d2-name"></div>
      <div class="dib-meta" id="d2-meta"></div>
    </div>
    <div class="dib-kpis">
      <div class="dib-kpi"><div class="dib-kpi-v" id="d2-visit" style="color:var(--accent)"></div><div class="dib-kpi-l">ë°©ë¬¸ìœ¨</div></div>
      <div class="dib-kpi"><div class="dib-kpi-v" id="d2-c1" style="color:var(--accent2)"></div><div class="dib-kpi-l">1ì°¨ì ‘ì´‰</div></div>
      <div class="dib-kpi"><div class="dib-kpi-v" id="d2-c2" style="color:var(--gold)"></div><div class="dib-kpi-l">2ì°¨ì ‘ì´‰</div></div>
      <div class="dib-kpi"><div class="dib-kpi-v" id="d2-success" style="color:var(--success)"></div><div class="dib-kpi-l">ì„±ê³µë¥ </div></div>
    </div>
  </div>

  <div class="filter-bar">
    <span style="font-size:12px;color:var(--text3);">í•„í„°:</span>
    <button class="filter-btn active" onclick="filterCustomers('all',this)">ì „ì²´</button>
    <button class="filter-btn" onclick="filterCustomers('urgent',this)">ğŸš¨ ì¦‰ì‹œì¡°ì¹˜í•„ìš”</button>
    <button class="filter-btn" onclick="filterCustomers('inprogress',this)">ì§„í–‰ì¤‘</button>
    <button class="filter-btn" onclick="filterCustomers('success',this)">âœ… ê³„ì•½ì™„ë£Œ</button>
    <button class="filter-btn" onclick="filterCustomers('fail',this)">âŒ ì´íƒˆ</button>
  </div>

  <div class="customer-table-wrap">
    <table class="customer-table">
      <thead>
        <tr>
          <th>ê³ ê°ëª…</th>
          <th>ë³‘ì›/ê¸°ê´€</th>
          <th>ë¬¸ì˜ì¼</th>
          <th>1ì°¨ì ‘ì´‰</th>
          <th>2ì°¨ì ‘ì´‰(ë°©ë¬¸)</th>
          <th>ì˜ì—…ë‹¨ê³„</th>
          <th>ë°©ë¬¸ì—¬ë¶€</th>
          <th>ìƒíƒœ</th>
        </tr>
      </thead>
      <tbody id="customerTbody"></tbody>
    </table>
  </div>
</div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• SCREEN 3 -->
<div class="screen" id="screen3">
<div class="main">
  <button class="back-btn" id="backBtn3" onclick="goScreen(2)">â† ê³ ê° ë¦¬ìŠ¤íŠ¸ë¡œ</button>
  <div class="customer-detail-grid">
    <div class="customer-info-card">
      <div class="cust-avatar" id="d3-avatar"></div>
      <div class="cust-name" id="d3-name"></div>
      <div class="cust-hospital" id="d3-hospital"></div>
      <div class="info-divider"></div>
      <div class="info-row"><span class="info-label">ë‹´ë‹¹ ì˜ì—…ì‚¬ì›</span><span class="info-value" id="d3-sales"></span></div>
      <div class="info-row"><span class="info-label">ë¬¸ì˜ ì±„ë„</span><span class="info-value" id="d3-channel"></span></div>
      <div class="info-row"><span class="info-label">ë¬¸ì˜ì¼</span><span class="info-value" id="d3-inqdate"></span></div>
      <div class="info-row"><span class="info-label">ê´€ì‹¬ ìƒí’ˆ</span><span class="info-value" id="d3-product"></span></div>
      <div class="info-row"><span class="info-label">í˜„ì¬ ë‹¨ê³„</span><span class="info-value" id="d3-stage"></span></div>
      <div class="kpi-mini-grid">
        <div class="kpi-mini"><div class="kpi-mini-v" id="d3-c1" style="color:var(--accent2)"></div><div class="kpi-mini-l">1ì°¨ ì ‘ì´‰</div></div>
        <div class="kpi-mini"><div class="kpi-mini-v" id="d3-c2" style="color:var(--gold)"></div><div class="kpi-mini-l">2ì°¨ ì ‘ì´‰</div></div>
        <div class="kpi-mini"><div class="kpi-mini-v" id="d3-visited" style="color:var(--success)"></div><div class="kpi-mini-l">ë°©ë¬¸ì—¬ë¶€</div></div>
        <div class="kpi-mini"><div class="kpi-mini-v" id="d3-result" style="color:var(--accent)"></div><div class="kpi-mini-l">ê²°ê³¼</div></div>
      </div>
    </div>
    <div class="timeline-card">
      <div class="timeline-title">ğŸ“‹ ì˜ì—… ì§„í–‰ ê³¼ì •</div>
      <div class="timeline" id="d3-timeline"></div>
      <div class="next-action-box" id="d3-nextaction"></div>
    </div>
  </div>
</div>
</div>

<script>
// â”€â”€ ë‚ ì§œ ìœ í‹¸ â”€â”€
const today = new Date(); today.setHours(0,0,0,0);
function daysAgo(n) { const d = new Date(today); d.setDate(d.getDate()-n); return d; }
function fmtDate(d) { return d.toISOString().slice(0,10); }
function parseDate(s) { const d = new Date(s); d.setHours(0,0,0,0); return d; }

document.getElementById('dateBadge').textContent = new Date().toLocaleDateString('ko-KR',{year:'numeric',month:'long',day:'numeric'});

// â”€â”€ ëª©í‘œ ê¸°ì¤€ â”€â”€
const GOAL = { c1: 1, c2: 3, visit: 80, success: 80 };

// â”€â”€ ì „ì²´ ê³ ê° raw ë°ì´í„° (ëŒ€ë¦¬ì ë³„, ë¬¸ì˜ì ‘ìˆ˜ì¼ í¬í•¨) â”€â”€
const allRawCustomers = {
  'ìœ ë¹„ê°•ë‚¨':    genCustomers('ìœ ë¹„ê°•ë‚¨',    42, [0.2,0.5], [1.5,2.5], 91, 67),
  'ì—ë²„ë„·':      genCustomers('ì—ë²„ë„·',      55, [0.3,0.8], [1.8,2.8], 88, 61),
  'ì´ì•ˆë©”ë“œ':    genCustomers('ì´ì•ˆë©”ë“œ',    48, [0.5,1.0], [2.0,3.0], 85, 58),
  'ì„¸ì¼ë©”ë””íŒœ':  genCustomers('ì„¸ì¼ë©”ë””íŒœ',  44, [0.6,1.1], [2.2,3.2], 82, 55),
  'ë¹„ì¦ˆí˜„ë©”ë””ì¹¼':genCustomers('ë¹„ì¦ˆí˜„ë©”ë””ì¹¼',38, [0.8,1.3], [2.5,3.5], 79, 51),
  'ë””ì¼€ì´íŒœì¼€ì–´':genCustomers('ë””ì¼€ì´íŒœì¼€ì–´',41, [0.9,1.4], [2.8,3.8], 76, 49),
  'ë””ì›ì¼€ì–´':    genCustomers('ë””ì›ì¼€ì–´',    35, [1.0,1.6], [3.0,4.0], 74, 46),
  'ìœ ë¹„ê²½ì¸':    genCustomers('ìœ ë¹„ê²½ì¸',    40, [1.2,1.8], [3.2,4.4], 68, 44),
  'ë””ë¼ì¸':      genCustomers('ë””ë¼ì¸',      36, [1.3,1.9], [3.3,4.5], 65, 41),
  'ë‘ë¦¬ì•¤íŒœ':    genCustomers('ë‘ë¦¬ì•¤íŒœ',    30, [1.5,2.1], [3.8,4.8], 62, 38),
  'ë©”ë””ì¼€ì–´':    genCustomers('ë©”ë””ì¼€ì–´',    28, [1.7,2.3], [4.0,5.0], 58, 35),
  'ì˜¬ë°ì´íŒœ':    genCustomers('ì˜¬ë°ì´íŒœ',    26, [1.9,2.5], [4.2,5.4], 55, 32),
  'ì´ì˜¤ì•¤íŒœ':    genCustomers('ì´ì˜¤ì•¤íŒœ',    24, [2.1,2.7], [4.6,5.8], 51, 28),
  'ì•„ì´í¬ì»¤ìŠ¤':  genCustomers('ì•„ì´í¬ì»¤ìŠ¤',  20, [2.3,2.9], [4.9,6.1], 48, 25),
  'ë™ì›ë©”ë””í…':  genCustomers('ë™ì›ë©”ë””í…',  18, [2.6,3.2], [5.2,6.6], 44, 21),
};

// ìƒ˜í”Œ ê³ ê° ìƒì„±ê¸° (ë¬¸ì˜ì ‘ìˆ˜ì¼ ìµœê·¼ 1ë…„ ëœë¤ ë¶„í¬)
function genCustomers(dealerName, count, c1Range, c2Range, visitRate, successRate) {
  const names = ['ê¹€ë¯¼ì¤€','ì´ì„œì—°','ë°•ì§€í˜¸','ìµœìˆ˜ì•„','ì •íƒœì–‘','í•œë¯¸ë˜','ìœ¤ì„œì¤€','ê°•ì§€ìš°','ì„ì†Œìœ¤','ì¡°í˜„ìš°',
                 'ì‹ ì˜ˆì€','ì˜¤ë¯¼ì„','í™©ì§€ìˆ˜','ì•ˆì¬ì›','ë°°ë‹¤ì€','ìœ ìŠ¹í˜„','ë¬¸ì±„ì›','ë…¸ì¤€í˜','ì‹¬ë‚˜ì—°','ì „ë„ìœ¤'];
  const hospitals = ['ì—°ì„¸ë‚´ê³¼','ë¯¸ë˜ì •í˜•ì™¸ê³¼','ì¢‹ì€ì¹˜ê³¼','ì„œìš¸ì•ˆê³¼','í–‰ë³µì˜ì›','365ì˜ì›','ì´ë“ ì˜ì›',
                     'ìƒˆë²½ì˜ì›','í•œë§ˆìŒì˜ì›','ê±´ê°•í•œì˜ì›','ë°ì€ì¹˜ê³¼','íŠ¼íŠ¼ì •í˜•ì™¸ê³¼','ë§‘ì€ì•ˆê³¼','ì°¸ì˜ì›'];
  const products = ['EMR Pro','EMR Basic','EMR + PACS','ì¹˜ê³¼ EMR','í•œì˜ EMR'];
  const channels = ['í™ˆí˜ì´ì§€','ì „í™”','ì´ë©”ì¼','SNS','ì§€ì¸ì†Œê°œ','ì „ì‹œíšŒ'];
  const salesmen = ['ì´ì§€í›ˆ','ìµœí˜„ìš°','ë°•ì„±ë¯¼','ê¹€ë„í¬'];

  return Array.from({length: count}, (_, i) => {
    // ë¬¸ì˜ ì ‘ìˆ˜ì¼: ìµœê·¼ 365ì¼ ì¤‘ ëœë¤
    const daysBack = Math.floor(Math.random() * 365);
    const inquiryDate = fmtDate(daysAgo(daysBack));

    const c1Val = +(c1Range[0] + Math.random()*(c1Range[1]-c1Range[0])).toFixed(1);
    const c2Val = +(c2Range[0] + Math.random()*(c2Range[1]-c2Range[0])).toFixed(1);
    const visited = Math.random()*100 < visitRate;
    const success = visited && Math.random()*100 < successRate;
    const urgent = !visited && c2Val > GOAL.c2;

    let stage = 1;
    if (c1Val > 0) stage = 2;
    if (visited) stage = 3;
    if (stage===3 && Math.random()>0.4) stage = 4;
    if (success) stage = 4;

    const status = success ? 'success' : urgent ? 'urgent' : 'inprogress';

    return {
      id: i+1,
      name: names[i % names.length],
      hospital: hospitals[i % hospitals.length],
      inquiryDate,
      c1: c1Val <= 0.5 ? 'ë‹¹ì¼' : c1Val+'ì¼',
      c1Val,
      c2: c2Val+'ì¼',
      c2Val,
      stage, visited,
      status, urgent,
      sales: salesmen[i % salesmen.length],
      channel: channels[i % channels.length],
      product: products[i % products.length],
      result: success?'ê³„ì•½ì™„ë£Œ': visited?'ì§„í–‰ì¤‘': c1Val>GOAL.c1?'ì ‘ì´‰ì§€ì—°':'ë°©ë¬¸ë¯¸ì§„í–‰',
      timeline: [
        {date: inquiryDate, title:'ë¬¸ì˜ ì ‘ìˆ˜', type:'blue', content:'ì‹ ê·œ ë¬¸ì˜ê°€ CRMì— ìë™ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.', tags:[channels[i%channels.length]], result:'normal'},
        ...(c1Val > 0 ? [{date: fmtDate(new Date(new Date(inquiryDate).getTime()+c1Val*86400000)), title:'1ì°¨ ì ‘ì´‰ (ì „í™”)', type:'cyan', content:`ì „í™” ìƒë‹´ ì™„ë£Œ. ì œí’ˆ ê´€ì‹¬ í™•ì¸.`, tags:['ì „í™”', c1Val<=GOAL.c1?'ëª©í‘œë‹¬ì„±':'ì§€ì—°'], result: c1Val<=GOAL.c1?'good':'warn'}] : []),
        ...(visited ? [{date: fmtDate(new Date(new Date(inquiryDate).getTime()+(c1Val+c2Val)*86400000)), title:'2ì°¨ ì ‘ì´‰ (ë°©ë¬¸)', type:'gold', content:'ë°©ë¬¸ ë°ëª¨ ì§„í–‰. ì œí’ˆ ì‹œì—° ì™„ë£Œ.', tags:['ë°©ë¬¸', c2Val<=GOAL.c2?'ëª©í‘œë‹¬ì„±':'ì§€ì—°'], result: c2Val<=GOAL.c2?'good':'warn'}] : []),
        ...(success ? [{date: fmtDate(new Date(new Date(inquiryDate).getTime()+(c1Val+c2Val+7)*86400000)), title:'ê³„ì•½ ì²´ê²° âœ…', type:'green', content:'ìµœì¢… ê³„ì•½ ì™„ë£Œ.', tags:['ê³„ì•½'], result:'good'}] : []),
      ],
      nextAction: urgent ? `ğŸš¨ ì¦‰ì‹œ ì¡°ì¹˜ í•„ìš”: ${!visited?'ë°©ë¬¸ ì¼ì • ì¦‰ì‹œ í™•ì •':'ì ‘ì´‰ ì¬ì‹œë„'}` : success ? 'ì„¤ì¹˜ ë° êµìœ¡ ì¼ì • ì¡°ìœ¨' : 'ë‹¤ìŒ ì˜ì—… ë‹¨ê³„ ì§„í–‰'
    };
  });
}

// â”€â”€ ê¸°ê°„ í•„í„° ìƒíƒœ â”€â”€
let filterFrom = daysAgo(90);
let filterTo   = today;

// â”€â”€ ê¸°ê°„ í•„í„° ì ìš© í›„ ëŒ€ë¦¬ì ë³„ ì§‘ê³„ â”€â”€
function calcDealerStats() {
  return ['ìœ ë¹„ê°•ë‚¨','ì—ë²„ë„·','ì´ì•ˆë©”ë“œ','ì„¸ì¼ë©”ë””íŒœ','ë¹„ì¦ˆí˜„ë©”ë””ì¹¼','ë””ì¼€ì´íŒœì¼€ì–´','ë””ì›ì¼€ì–´',
          'ìœ ë¹„ê²½ì¸','ë””ë¼ì¸','ë‘ë¦¬ì•¤íŒœ','ë©”ë””ì¼€ì–´','ì˜¬ë°ì´íŒœ','ì´ì˜¤ì•¤íŒœ','ì•„ì´í¬ì»¤ìŠ¤','ë™ì›ë©”ë””í…']
  .map(name => {
    const region = {
      'ìœ ë¹„ê°•ë‚¨':'ê°•ë‚¨Â·ì„œì´ˆÂ·ê°•ë™Â·ì†¡íŒŒÂ·í•˜ë‚¨','ì—ë²„ë„·':'ìˆ˜ì›Â·ì„±ë‚¨Â·ë¶„ë‹¹Â·ìš©ì¸ ì™¸',
      'ì´ì•ˆë©”ë“œ':'ì€í‰Â·ì¼ì‚°Â·ê³ ì–‘Â·íŒŒì£¼Â·ì¢…ë¡œ ì™¸','ì„¸ì¼ë©”ë””íŒœ':'ê°•ë¶Â·ë…¸ì›Â·ë„ë´‰Â·ì˜ì •ë¶€Â·ë‚¨ì–‘ì£¼ ì™¸',
      'ë¹„ì¦ˆí˜„ë©”ë””ì¹¼':'ë¶€ì²œÂ·êµ¬ë¡œÂ·ê¸ˆì²œÂ·ê°•ì„œÂ·ì–‘ì²œ ì™¸','ë””ì¼€ì´íŒœì¼€ì–´':'ëŒ€êµ¬Â·ê²½ì‚°Â·êµ¬ë¯¸Â·ê¹€ì²œÂ·ì•ˆë™ ì™¸',
      'ë””ì›ì¼€ì–´':'ë¶€ì‚°Â·ìš¸ì‚°Â·ì–‘ì‚°','ìœ ë¹„ê²½ì¸':'ì¸ì²œÂ·ì‹œí¥Â·ê¹€í¬Â·ì•ˆì–‘Â·ì•ˆì‚° ì™¸',
      'ë””ë¼ì¸':'ê²½ë‚¨Â·ì°½ì›Â·ê¹€í•´Â·ì§„ì£¼Â·ê±°ì œ ì™¸','ë‘ë¦¬ì•¤íŒœ':'ì „ë‚¨ ì „ì²´Â·ê´‘ì£¼',
      'ë©”ë””ì¼€ì–´':'ì¶©ë¶ ì „ì²´Â·ì„¸ì¢…Â·ì—°ê¸°êµ°','ì˜¬ë°ì´íŒœ':'ì¶©ë‚¨ ì „ì²´Â·ì˜ë™Â·ì˜¥ì²œ',
      'ì´ì˜¤ì•¤íŒœ':'ì „ì£¼Â·ì „ë¶ ì „ì²´','ì•„ì´í¬ì»¤ìŠ¤':'ê°•ì› ì „ì²´','ë™ì›ë©”ë””í…':'í¬í•­Â·ê²½ì£¼Â·ì˜ì²œÂ·ì˜ë•Â·ìš¸ì§„'
    }[name];

    // ê¸°ê°„ í•„í„° ì ìš©
    const filtered = (allRawCustomers[name]||[]).filter(c => {
      const d = parseDate(c.inquiryDate);
      return d >= filterFrom && d <= filterTo;
    });

    const total = filtered.length;
    if (total === 0) return { name, region, visit:0, c1:0, c2:0, success:0, total:0, contract:0 };

    const visited    = filtered.filter(c => c.visited);
    const contracted = filtered.filter(c => c.status==='success');
    const visit    = Math.round(visited.length / total * 100);
    const success  = total > 0 ? Math.round(contracted.length / total * 100) : 0;
    const c1       = total > 0 ? +( filtered.reduce((s,c)=>s+c.c1Val,0)/total ).toFixed(1) : 0;
    const c2       = visited.length > 0 ? +( visited.reduce((s,c)=>s+c.c2Val,0)/visited.length ).toFixed(1) : 0;
    const contract = contracted.length;

    return { name, region, visit, c1, c2, success, total, contract };
  });
}

// â”€â”€ ëŒ€ë¦¬ì  ë°ì´í„° (ë™ì ) â”€â”€
let dealers = [];

function refreshDealers() {
  const raw = calcDealerStats();
  raw.forEach(d => { d.score = calcScore(d); });
  raw.sort((a,b) => b.score - a.score);
  raw.forEach((d,i) => {
    d.rank = i+1;
    const metCount = [d.c1<=GOAL.c1&&d.c1>0, d.c2<=GOAL.c2&&d.c2>0, d.visit>=GOAL.visit, d.success>=GOAL.success].filter(Boolean).length;
    d.status = metCount===4?'excellent':metCount===3?'good':metCount===2?'normal':metCount===1?'warning':'danger';
  });
  dealers = raw;
}

function calcScore(d) {
  if (d.total === 0) return 0;
  const s1 = d.c1 > 0 ? Math.min(100, (GOAL.c1/d.c1)*100) : 0;
  const s2 = d.c2 > 0 ? Math.min(100, (GOAL.c2/d.c2)*100) : 0;
  const s3 = Math.min(100, (d.visit/GOAL.visit)*100);
  const s4 = Math.min(100, (d.success/GOAL.success)*100);
  return (s1+s2+s3+s4)/4;
}


// â”€â”€ ê³ ê° ë°ì´í„° â”€â”€
const customersMap = {
  'ë‘ë¦¬ì•¤íŒœ': [
    { id:1, name:'ê¹€ë¯¼ì¤€', hospital:'ê°•ë™ë¯¸ë˜ì˜ì›', inquiryDate:'2025-05-01', c1:'ë‹¹ì¼', c2:'2ì¼', stage:4, visited:true, status:'success', urgent:false,
      sales:'ì´ì§€í›ˆ', channel:'í™ˆí˜ì´ì§€', product:'EMR Pro', result:'ê³„ì•½ì™„ë£Œ',
      timeline:[
        {date:'2025-05-01',title:'í™ˆí˜ì´ì§€ ë¬¸ì˜ ì ‘ìˆ˜',type:'blue',content:'EMR ì‹œìŠ¤í…œ ë„ì… ë¬¸ì˜. í˜„ì¬ íƒ€ì‚¬ ì œí’ˆ ì‚¬ìš© ì¤‘ì´ë©° ê¸°ëŠ¥ ê°œì„  í•„ìš”ì„± ëŠë‚Œ.',tags:['1ì°¨ì ‘ì´‰ë‹¹ì¼'],result:'normal'},
        {date:'2025-05-01',title:'ë‹¹ì¼ ì „í™” ìƒë‹´ (1ì°¨ ì ‘ì´‰)',type:'cyan',content:'ì›ì¥ë‹˜ ì§ì ‘ í†µí™”. í˜„ ì‹œìŠ¤í…œ ë¶ˆë§Œì‚¬í•­ íŒŒì•…: ì²˜ë°©ì „ ì—°ë™ ì†ë„, UI ë³µì¡ì„±. ë°©ë¬¸ ë°ëª¨ ìˆ˜ë½.',tags:['ì „í™”','18ë¶„'],result:'good'},
        {date:'2025-05-03',title:'ë°©ë¬¸ ë°ëª¨ ì§„í–‰ (2ì°¨ ì ‘ì´‰)',type:'gold',content:'1ì‹œê°„ 30ë¶„ ë°ëª¨. EMR Pro ì²˜ë°© ì—°ë™ ì†ë„ ì‹œì—°. ê°„í˜¸ì‚¬ 2ëª…ë„ ë™ì„í•˜ì—¬ ê¸ì •ì  ë°˜ì‘. ê²¬ì ì„œ ìš”ì²­.',tags:['ë°©ë¬¸','ë°ëª¨'],result:'good'},
        {date:'2025-05-08',title:'ê²¬ì ì„œ ì œì¶œ ë° í˜‘ìƒ',type:'blue',content:'3ê°œì›” ë¬´ìƒ ì§€ì› ì¡°ê±´ìœ¼ë¡œ ìµœì¢… ê²¬ì  ì œì¶œ. ê²½ìŸì‚¬ ëŒ€ë¹„ ê°€ê²© ìš°ìœ„ ì„¤ëª….',tags:['ê²¬ì '],result:'good'},
        {date:'2025-05-12',title:'ê³„ì•½ ì²´ê²° âœ…',type:'green',content:'ì—°ê°„ ê³„ì•½ ì²´ê²° ì™„ë£Œ. 6ì›” 1ì¼ ì„¤ì¹˜ ì˜ˆì •. ì›ì¥ë‹˜ ì§€ì¸ ë³‘ì› ì†Œê°œ ì•½ì† ë°›ìŒ.',tags:['ê³„ì•½','ë ˆí¼ëŸ´í™•ë³´'],result:'good'},
      ],
      nextAction:'ì„¤ì¹˜ ì¼ì • í™•ì • ë° ì§ì› êµìœ¡ ì¼ì • ì¡°ìœ¨ (6ì›” 1ì¼ ëª©í‘œ)'
    },
    { id:2, name:'ë°•ì„œì—°', hospital:'ì„œìš¸ì•„ì´ì •í˜•ì™¸ê³¼', inquiryDate:'2025-05-03', c1:'1ì¼', c2:'3ì¼', stage:3, visited:true, status:'inprogress', urgent:false,
      sales:'ìµœí˜„ìš°', channel:'ì „í™”', product:'EMR + PACS', result:'ê²¬ì í˜‘ì˜ì¤‘',
      timeline:[
        {date:'2025-05-03',title:'ì „í™” ë¬¸ì˜ ì ‘ìˆ˜',type:'blue',content:'PACS ì—°ë™ EMR ë¬¸ì˜. í˜„ì¬ ì˜ìƒì˜í•™ê³¼ ì—°ë™ì´ ì•ˆ ë˜ì–´ ë¶ˆí¸ í˜¸ì†Œ.',tags:['1ì°¨ì ‘ì´‰1ì¼'],result:'normal'},
        {date:'2025-05-04',title:'ì „í™” ìƒë‹´ (1ì°¨ ì ‘ì´‰)',type:'cyan',content:'15ë¶„ í†µí™”. PACS ì—°ë™ ê¸°ëŠ¥ ì„¤ëª…. ë°ëª¨ ë°©ë¬¸ ì¼ì • í˜‘ì˜.',tags:['ì „í™”'],result:'good'},
        {date:'2025-05-06',title:'ë°©ë¬¸ ë°ëª¨ (2ì°¨ ì ‘ì´‰)',type:'gold',content:'PACS+EMR í†µí•© ë°ëª¨. ì›ì¥ë‹˜ ë§Œì¡±ë„ ë†’ìŒ. ì›ë¬´íŒ€ì¥ ì¶”ê°€ êµìœ¡ ìš”ì²­.',tags:['ë°©ë¬¸','ë°ëª¨'],result:'good'},
        {date:'2025-05-10',title:'ì›ë¬´íŒ€ ì¶”ê°€ êµìœ¡',type:'blue',content:'ì›ë¬´íŒ€ 3ëª… ëŒ€ìƒ 1ì‹œê°„ êµìœ¡. ì „í™˜ ì˜í–¥ ê°•í•¨.',tags:['êµìœ¡'],result:'good'},
      ],
      nextAction:'ì˜¤ëŠ˜ ì¤‘ ìµœì¢… ê²¬ì ì„œ ë°œì†¡ â†’ ì´ë²ˆ ì£¼ ë‚´ ê³„ì•½ ë§ˆë¬´ë¦¬ ëª©í‘œ'
    },
    { id:3, name:'ì´ìˆ˜í˜„', hospital:'ë™ë¶€ì—°ì„¸ë‚´ê³¼', inquiryDate:'2025-05-05', c1:'2ì¼', c2:'5ì¼', stage:2, visited:false, status:'urgent', urgent:true,
      sales:'ì´ì§€í›ˆ', channel:'ì´ë©”ì¼', product:'EMR Basic', result:'ë°©ë¬¸ë¯¸ì§„í–‰',
      timeline:[
        {date:'2025-05-05',title:'ì´ë©”ì¼ ë¬¸ì˜ ì ‘ìˆ˜',type:'blue',content:'ì†Œê·œëª¨ ë‚´ê³¼ ì›ì¥. EMR Basic ê´€ì‹¬. ì˜ˆì‚° ì œí•œ ì–¸ê¸‰.',tags:['ë¬¸ì˜'],result:'normal'},
        {date:'2025-05-07',title:'ì „í™” ìƒë‹´ (1ì°¨ ì ‘ì´‰ 2ì¼ ì†Œìš”)',type:'cyan',content:'10ë¶„ í†µí™”. ë°©ë¬¸ ë°ëª¨ ì¼ì • í˜‘ì˜í–ˆìœ¼ë‚˜ "ë‹¤ìŒ ì£¼ì— ì—°ë½ë‹¬ë¼"ë©° ë³´ë¥˜.',tags:['ì „í™”','ë³´ë¥˜'],result:'warn'},
      ],
      nextAction:'ğŸš¨ ë°©ë¬¸ ë¯¸ì§„í–‰ 5ì¼ ì´ˆê³¼! ì˜¤ëŠ˜ ë°˜ë“œì‹œ ë°©ë¬¸ ì¼ì • í™•ì •. Best ëŒ€ë¦¬ì (ê°•ë‚¨)ì€ 3ì¼ ì´ë‚´ 100% ë°©ë¬¸ ì™„ë£Œ'
    },
    { id:4, name:'ì •ë‹¤ì€', hospital:'ê°•ë™ì•„ë™ì¹˜ê³¼', inquiryDate:'2025-05-06', c1:'ë‹¹ì¼', c2:'4ì¼', stage:2, visited:false, status:'urgent', urgent:true,
      sales:'ìµœí˜„ìš°', channel:'SNS', product:'ì¹˜ê³¼EMR', result:'ë°©ë¬¸ë¯¸ì§„í–‰',
      timeline:[
        {date:'2025-05-06',title:'SNS ê´‘ê³  ë¬¸ì˜',type:'blue',content:'ì¹˜ê³¼ íŠ¹í™” EMR ê´€ì‹¬. ì›ì¥ ì§ì ‘ DM ë°œì†¡.',tags:['ë‹¹ì¼ì ‘ì´‰'],result:'good'},
        {date:'2025-05-06',title:'ë‹¹ì¼ ì „í™” ìƒë‹´',type:'cyan',content:'15ë¶„ í†µí™”. ì¹˜ê³¼ íŠ¹í™” ê¸°ëŠ¥(ì¹˜ì‹ë„, ë°©ì‚¬ì„  ì—°ë™) ì†Œê°œ. ê´€ì‹¬ ë†’ìŒ.',tags:['ì „í™”'],result:'good'},
        {date:'2025-05-10',title:'ë°©ë¬¸ ì•½ì† ì·¨ì†Œ',type:'blue',content:'ì›ì¥ ìŠ¤ì¼€ì¤„ë¡œ ì·¨ì†Œ. ì¬ì¼ì • ë¯¸í™•ì •.',tags:['ì·¨ì†Œ'],result:'warn'},
      ],
      nextAction:'ğŸš¨ ë°©ë¬¸ ì§€ì—° 4ì¼! ì˜¤ëŠ˜ ì¬ë°©ë¬¸ ì•½ì† í™•ì •. ì·¨ì†Œ í›„ ì¬ì ‘ì´‰ ê³¨ë“ íƒ€ì„ ë‚´ ì‹¤í–‰ í•„ìš”'
    },
    { id:5, name:'í•œì§€í˜¸', hospital:'ì„±ë™365ì˜ì›', inquiryDate:'2025-04-20', c1:'ë‹¹ì¼', c2:'2ì¼', stage:4, visited:true, status:'success', urgent:false,
      sales:'ì´ì§€í›ˆ', channel:'ì§€ì¸ì†Œê°œ', product:'EMR Pro', result:'ê³„ì•½ì™„ë£Œ',
      timeline:[
        {date:'2025-04-20',title:'ì§€ì¸ ì†Œê°œ ë¬¸ì˜',type:'blue',content:'ê¸°ì¡´ ê³ ê° ì†Œê°œ. ì‹ ë¢°ë„ ë†’ì€ ìƒíƒœë¡œ ì‹œì‘.',tags:['ì†Œê°œ','ë‹¹ì¼ì ‘ì´‰'],result:'good'},
        {date:'2025-04-20',title:'ë‹¹ì¼ ì „í™”',type:'cyan',content:'ë°”ë¡œ ë°©ë¬¸ ìš”ì²­. ë‚´ì¼ ë°©ë¬¸ ì¼ì • í™•ì •.',tags:['ì „í™”'],result:'good'},
        {date:'2025-04-22',title:'ë°©ë¬¸ ë¯¸íŒ…',type:'gold',content:'ì†Œê°œ ê³ ê°ì´ë¼ ì‹ ë¢° ë†’ìŒ. 1íšŒ ë°©ë¬¸ìœ¼ë¡œ ê³„ì•½ ì˜í–¥ í™•ì¸.',tags:['ë°©ë¬¸'],result:'good'},
        {date:'2025-04-25',title:'ê³„ì•½ ì™„ë£Œ',type:'green',content:'2ë…„ ì¥ê¸° ê³„ì•½. ì¶”ê°€ ì§€ì  ë„ì… ë…¼ì˜ ì¤‘.',tags:['ê³„ì•½'],result:'good'},
      ],
      nextAction:'ì¶”ê°€ ì§€ì  ë„ì… ì œì•ˆì„œ ì¤€ë¹„ (2ì§€ì  ì¶”ê°€ ê°€ëŠ¥ì„±)'
    },
    { id:6, name:'ìœ¤ì¬ì›', hospital:'ê´‘ì§„ì—°í•©ì˜ì›', inquiryDate:'2025-05-08', c1:'3ì¼', c2:'ì—†ìŒ', stage:1, visited:false, status:'urgent', urgent:true,
      sales:'ìµœí˜„ìš°', channel:'í™ˆí˜ì´ì§€', product:'EMR Basic', result:'ì „í™”ë¯¸ì—°ê²°',
      timeline:[
        {date:'2025-05-08',title:'í™ˆí˜ì´ì§€ ë¬¸ì˜',type:'blue',content:'EMR ê¸°ë³¸ íŒ¨í‚¤ì§€ ë¬¸ì˜.',tags:['ë¬¸ì˜'],result:'normal'},
        {date:'2025-05-11',title:'ì „í™” ì‹œë„ ì‹¤íŒ¨ (1ì°¨ ì ‘ì´‰ 3ì¼ ì§€ì—°)',type:'cyan',content:'3íšŒ ì „í™” ì‹œë„ â†’ ëª¨ë‘ ë¶€ì¬ì¤‘. ë¬¸ì ë‚¨ê¹€.',tags:['ë¯¸ì—°ê²°','ì§€ì—°'],result:'bad'},
      ],
      nextAction:'ğŸš¨ 1ì°¨ ì ‘ì´‰ 3ì¼ ì§€ì—°! ì˜¤ì „ 9ì‹œ, ì ì‹¬ í›„ 12ì‹œ 30ë¶„ ì§‘ì¤‘ ì „í™”. ì—°ê²° ì•ˆ ë˜ë©´ ì§ì ‘ ë°©ë¬¸ìœ¼ë¡œ ì „í™˜'
    },
  ]
};

// ê¸°ë³¸ ê³ ê° ë°ì´í„° ìƒì„± í•¨ìˆ˜
function getCustomers(dealerName) {
  const all = allRawCustomers[dealerName] || [];
  return all.filter(c => {
    const d = parseDate(c.inquiryDate);
    return d >= filterFrom && d <= filterTo;
  });
}

// â”€â”€ ì „ì²´ í™”ë©´ ê°±ì‹  â”€â”€
function fullRefresh() {
  refreshDealers();
  renderDealerTable();
  renderCompare();

  // ê¸°ê°„ ë¼ë²¨ ì—…ë°ì´íŠ¸
  const from = filterFrom.toLocaleDateString('ko-KR',{month:'long',day:'numeric'});
  const to   = filterTo.toLocaleDateString('ko-KR',{month:'long',day:'numeric'});
  document.getElementById('periodLabel').textContent = `${from} ~ ${to} ì‹ ê·œ ë¬¸ì˜ ê¸°ì¤€ Â· ì „êµ­ 15ê°œ ëŒ€ë¦¬ì `;

  // ì „ì‚¬ KPI ì¹´ë“œ ê°’ ì—…ë°ì´íŠ¸
  const allFiltered = dealers;
  const avgC1 = allFiltered.filter(d=>d.c1>0).length > 0
    ? (allFiltered.filter(d=>d.c1>0).reduce((s,d)=>s+d.c1,0)/allFiltered.filter(d=>d.c1>0).length).toFixed(1) : '-';
  const avgC2 = allFiltered.filter(d=>d.c2>0).length > 0
    ? (allFiltered.filter(d=>d.c2>0).reduce((s,d)=>s+d.c2,0)/allFiltered.filter(d=>d.c2>0).length).toFixed(1) : '-';
  const avgVisit = allFiltered.length > 0
    ? Math.round(allFiltered.reduce((s,d)=>s+d.visit,0)/allFiltered.length) : 0;
  const avgSuccess = allFiltered.length > 0
    ? Math.round(allFiltered.reduce((s,d)=>s+d.success,0)/allFiltered.length) : 0;

  const vals = document.querySelectorAll('.kpi-card-value');
  vals[0].innerHTML = `${avgC1}<span style="font-size:20px">ì¼</span>`;
  vals[1].innerHTML = `${avgC2}<span style="font-size:20px">ì¼</span>`;
  vals[2].innerHTML = `${avgVisit}<span style="font-size:20px">%</span>`;
  vals[3].innerHTML = `${avgSuccess}<span style="font-size:20px">%</span>`;

  // ë°” ì—…ë°ì´íŠ¸
  const bars = document.querySelectorAll('.kpi-card-bar-fill');
  bars[0].style.width = Math.min(100, (GOAL.c1/Math.max(avgC1,0.1))*100)+'%';
  bars[1].style.width = Math.min(100, (GOAL.c2/Math.max(avgC2,0.1))*100)+'%';
  bars[2].style.width = avgVisit+'%';
  bars[3].style.width = avgSuccess+'%';
}

// â”€â”€ ê¸°ê°„ í•„í„° ì´ë²¤íŠ¸ â”€â”€
document.querySelectorAll('.period-btn[data-period]').forEach(btn => {
  btn.addEventListener('click', function() {
    document.querySelectorAll('.period-btn[data-period]').forEach(b=>b.classList.remove('active'));
    this.classList.add('active');
    const days = parseInt(this.dataset.period);
    filterFrom = daysAgo(days);
    filterTo   = today;
    // ë‚ ì§œ ì§ì ‘ì…ë ¥ ì´ˆê¸°í™”
    document.getElementById('dateFrom').value = '';
    document.getElementById('dateTo').value   = '';
    fullRefresh();
  });
});

document.getElementById('customApplyBtn').addEventListener('click', function() {
  const from = document.getElementById('dateFrom').value;
  const to   = document.getElementById('dateTo').value;
  if (!from || !to) { alert('ì‹œì‘ì¼ê³¼ ì¢…ë£Œì¼ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
  if (from > to)    { alert('ì‹œì‘ì¼ì´ ì¢…ë£Œì¼ë³´ë‹¤ ëŠ¦ìŠµë‹ˆë‹¤.'); return; }
  document.querySelectorAll('.period-btn[data-period]').forEach(b=>b.classList.remove('active'));
  filterFrom = parseDate(from);
  filterTo   = parseDate(to);
  fullRefresh();
});


// â”€â”€ í…Œì´ë¸” ë Œë”ë§ â”€â”€
function renderDealerTable() {
  const tbody = document.getElementById('dealerTbody');
  tbody.innerHTML = dealers.map(d => {
    const rankClass = d.rank===1?'rank-1':d.rank===2?'rank-2':d.rank===3?'rank-3':'rank-n';
    // ìƒˆ ëª©í‘œ ê¸°ì¤€ ìƒ‰ìƒ
    const c1Color    = d.c1 <= GOAL.c1           ? 'var(--success)' : d.c1 <= GOAL.c1*1.5   ? 'var(--warning)' : 'var(--danger)';
    const c2Color    = d.c2 <= GOAL.c2           ? 'var(--success)' : d.c2 <= GOAL.c2*1.5   ? 'var(--warning)' : 'var(--danger)';
    const visitColor = d.visit >= GOAL.visit      ? 'var(--success)' : d.visit >= GOAL.visit*0.75 ? 'var(--warning)' : 'var(--danger)';
    const succColor  = d.success >= GOAL.success  ? 'var(--success)' : d.success >= GOAL.success*0.75 ? 'var(--warning)' : 'var(--danger)';
    const pillClass  = d.status==='excellent'||d.status==='good' ? 'pill-green' : d.status==='normal' ? 'pill-yellow' : d.status==='warning' ? 'pill-yellow' : 'pill-red';
    const pillText   = d.status==='excellent'?'ëª©í‘œë‹¬ì„±':d.status==='good'?'ìš°ìˆ˜':d.status==='normal'?'ë³´í†µ':d.status==='warning'?'ì£¼ì˜':'ìœ„í—˜';
    const isMe = d.name==='ë‘ë¦¬ì•¤íŒœ';
    return `<tr class="${isMe?'my-row':''}" onclick="goScreen(2,'${d.name}')">
      <td><span class="rank-badge ${rankClass}">${d.rank}</span></td>
      <td><strong>${d.name}</strong>${isMe?'<span class="my-tag">ë‚´ ëŒ€ë¦¬ì </span>':''}<br><span style="font-size:11px;color:var(--text3)">${d.region}</span></td>
      <td><span style="color:${c1Color};font-weight:700">${d.c1}ì¼</span></td>
      <td><span style="color:${c2Color};font-weight:700">${d.c2}ì¼</span></td>
      <td><span class="clickable-num" style="color:${visitColor}" onclick="event.stopPropagation();goScreen(2,'${d.name}')">${d.visit}%</span></td>
      <td><span style="color:${succColor};font-weight:700">${d.success}%</span></td>
      <td class="clickable-num" onclick="event.stopPropagation();goScreen(2,'${d.name}')">${d.total}ëª…</td>
      <td><strong>${d.contract}</strong></td>
      <td><span class="pill ${pillClass}">${pillText}</span></td>
    </tr>`;
  }).join('');
}

let currentDealer = null;
let allCustomers = [];

function renderCustomerTable(customers) {
  const tbody = document.getElementById('customerTbody');
  const stageNames = ['','ë¬¸ì˜ì ‘ìˆ˜','ì „í™”ìƒë‹´','ë°©ë¬¸ë°ëª¨','ê²¬ì í˜‘ì˜','ê³„ì•½ì™„ë£Œ/ì´íƒˆ'];
  const stageClass = ['','stage-1','stage-2','stage-3','stage-4','stage-4'];
  tbody.innerHTML = customers.map(c => {
    const sc = c.status==='success'?'stage-4':c.status==='urgent'?'stage-5':c.status==='fail'?'stage-5':'stage-2';
    const stageLabel = stageNames[Math.min(c.stage,5)];
    const visitBadge = c.visited?`<span class="pill pill-green">âœ“ ë°©ë¬¸ì™„ë£Œ</span>`:`<span class="pill pill-red">âœ— ë¯¸ë°©ë¬¸</span>`;
    const urgentTag = c.urgent?'<span style="color:var(--danger);font-weight:700;font-size:11px;margin-left:4px">ğŸš¨ ê¸´ê¸‰</span>':'';
    return `<tr onclick="goScreen(3,null,null,${c.id})">
      <td><strong>${c.name}</strong>${urgentTag}</td>
      <td>${c.hospital}</td>
      <td style="color:var(--text3)">${c.inquiryDate}</td>
      <td>${c.c1}</td>
      <td>${c.c2}</td>
      <td><span class="stage-badge ${stageClass[Math.min(c.stage,5)]}">${stageLabel}</span></td>
      <td>${visitBadge}</td>
      <td>${c.result}</td>
    </tr>`;
  }).join('');
}

function filterCustomers(type, btn) {
  document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  if(type==='all') renderCustomerTable(allCustomers);
  else if(type==='urgent') renderCustomerTable(allCustomers.filter(c=>c.urgent||c.status==='urgent'));
  else if(type==='inprogress') renderCustomerTable(allCustomers.filter(c=>c.status==='inprogress'));
  else if(type==='success') renderCustomerTable(allCustomers.filter(c=>c.status==='success'));
  else if(type==='fail') renderCustomerTable(allCustomers.filter(c=>c.status==='fail'));
}

// â”€â”€ í™”ë©´ ì „í™˜ â”€â”€
function goScreen(n, dealerName, urgentFilter, customerId) {
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  document.getElementById('screen'+n).classList.add('active');
  updateBreadcrumb(n, dealerName, customerId);

  if(n===2 && dealerName) {
    currentDealer = dealers.find(d=>d.name===dealerName);
    allCustomers = getCustomers(dealerName);
    document.getElementById('d2-name').textContent = `${dealerName} ëŒ€ë¦¬ì `;
    document.getElementById('d2-meta').textContent = `ë‹´ë‹¹ ê³ ê° ${currentDealer.total}ëª… Â· ê³„ì•½ ${currentDealer.contract}ê±´`;
    document.getElementById('d2-visit').textContent = currentDealer.visit+'%';
    document.getElementById('d2-c1').textContent = currentDealer.c1+'ì¼';
    document.getElementById('d2-c2').textContent = currentDealer.c2+'ì¼';
    document.getElementById('d2-success').textContent = currentDealer.success+'%';
    // í•„í„° ë¦¬ì…‹
    document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
    document.querySelector('.filter-btn').classList.add('active');
    if(urgentFilter) {
      setTimeout(()=>{
        const urgentBtn = document.querySelectorAll('.filter-btn')[1];
        filterCustomers('urgent', urgentBtn);
      },100);
    } else {
      renderCustomerTable(allCustomers);
    }
  }
  if(n===3 && customerId) {
    const c = allCustomers.find(x=>x.id===customerId);
    if(!c) return;
    document.getElementById('d3-avatar').textContent = c.name[0];
    document.getElementById('d3-name').textContent = c.name;
    document.getElementById('d3-hospital').textContent = c.hospital;
    document.getElementById('d3-sales').textContent = c.sales;
    document.getElementById('d3-channel').textContent = c.channel;
    document.getElementById('d3-inqdate').textContent = c.inquiryDate;
    document.getElementById('d3-product').textContent = c.product;
    const stages=['','ë¬¸ì˜ì ‘ìˆ˜','ì „í™”ìƒë‹´','ë°©ë¬¸ë°ëª¨','ê²¬ì í˜‘ì˜','ê³„ì•½ì™„ë£Œ'];
    document.getElementById('d3-stage').textContent = stages[Math.min(c.stage,5)];
    document.getElementById('d3-c1').textContent = c.c1;
    document.getElementById('d3-c2').textContent = c.c2;
    document.getElementById('d3-visited').textContent = c.visited?'ì™„ë£Œ':'ë¯¸ë°©ë¬¸';
    document.getElementById('d3-result').textContent = c.result;
    // íƒ€ì„ë¼ì¸
    const dotClass = {blue:'tl-dot-blue',cyan:'tl-dot-cyan',green:'tl-dot-green',gold:'tl-dot-gold',red:'tl-dot-red'};
    const resultClass = {good:'tl-result-good',warn:'tl-result-warn',bad:'tl-result-bad',normal:''};
    document.getElementById('d3-timeline').innerHTML = c.timeline.map(t=>`
      <div class="tl-item">
        <div class="tl-dot ${dotClass[t.type]||'tl-dot-blue'}"></div>
        <div class="tl-date">${t.date}</div>
        <div class="tl-title">${t.title}</div>
        <div class="tl-content ${resultClass[t.result]||''}">${t.content}</div>
        <div class="tl-meta">${t.tags.map(tag=>`<span class="tl-tag">${tag}</span>`).join('')}</div>
      </div>
    `).join('');
    const urgent = c.urgent||c.status==='urgent';
    document.getElementById('d3-nextaction').innerHTML = `
      <div class="nab-title">${urgent?'ğŸš¨ ì¦‰ì‹œ ì¡°ì¹˜ í•„ìš”':'ğŸ“Œ ë‹¤ìŒ ì•¡ì…˜'}</div>
      <div class="nab-content">${c.nextAction}</div>
    `;
    document.getElementById('d3-nextaction').style.borderColor = urgent?'rgba(239,68,68,0.4)':'rgba(59,130,246,0.3)';
    document.getElementById('d3-nextaction').style.background = urgent?'rgba(239,68,68,0.08)':'rgba(59,130,246,0.08)';
  }
  window.scrollTo({top:0,behavior:'smooth'});
}

function updateBreadcrumb(n, dealerName, customerId) {
  const bc = document.getElementById('breadcrumb');
  if(n===1) {
    bc.innerHTML=`<span class="crumb active">ì „ì²´ ëŒ€ì‹œë³´ë“œ</span>`;
  } else if(n===2) {
    bc.innerHTML=`<span class="crumb" onclick="goScreen(1)">ì „ì²´ ëŒ€ì‹œë³´ë“œ</span><span class="sep">â€º</span><span class="crumb active">${dealerName||currentDealer?.name} ëŒ€ë¦¬ì </span>`;
  } else if(n===3) {
    const c = allCustomers.find(x=>x.id===customerId);
    bc.innerHTML=`<span class="crumb" onclick="goScreen(1)">ì „ì²´ ëŒ€ì‹œë³´ë“œ</span><span class="sep">â€º</span><span class="crumb" onclick="goScreen(2)">${currentDealer?.name} ëŒ€ë¦¬ì </span><span class="sep">â€º</span><span class="crumb active">${c?.name||'ê³ ê°ìƒì„¸'}</span>`;
  }
}

// â”€â”€ ì´ˆê¸°í™” â”€â”€
fullRefresh();

// â”€â”€ ë¹„êµ ì„¹ì…˜ ë™ì  ë Œë”ë§ â”€â”€
function renderCompare() {
  const me   = dealers.find(d => d.name === 'ë‘ë¦¬ì•¤íŒœ') || dealers[dealers.length-1];
  const best = dealers[0];
  if (!me || !best) return;

  document.getElementById('roleBadge').textContent = me.name + ' ëŒ€ë¦¬ì ';
  document.querySelector('.compare-label.best').textContent = 'ğŸ† ' + best.name + ' (Best)';
  document.querySelector('.compare-label.mine').textContent = 'ğŸ¢ ' + me.name + ' (ë‚´ ëŒ€ë¦¬ì )';

  function colorC1(v) { return v<=GOAL.c1&&v>0?'good':v<=GOAL.c1*1.5&&v>0?'warn':'bad'; }
  function colorC2(v) { return v<=GOAL.c2&&v>0?'good':v<=GOAL.c2*1.5&&v>0?'warn':'bad'; }
  function colorV(v)  { return v>=GOAL.visit?'good':v>=GOAL.visit*0.75?'warn':'bad'; }
  function colorS(v)  { return v>=GOAL.success?'good':v>=GOAL.success*0.75?'warn':'bad'; }

  const mineList = document.querySelectorAll('.compare-side')[0].querySelector('.kpi-compare-list');
  mineList.innerHTML = `
    <div class="kpi-compare-item highlight-mine"><div><div class="kci-name">1ì°¨ ì ‘ì´‰ê¸°ê°„</div><div class="kci-sub">ë¬¸ì˜â†’ì „í™” í‰ê·  Â· ëª©í‘œ ${GOAL.c1}ì¼ ì´ë‚´</div></div><div style="text-align:right"><div class="kci-value ${colorC1(me.c1)}">${me.c1||'-'}ì¼</div></div></div>
    <div class="kpi-compare-item highlight-mine"><div><div class="kci-name">2ì°¨ ì ‘ì´‰ê¸°ê°„</div><div class="kci-sub">ì „í™”â†’ë°©ë¬¸ í‰ê·  Â· ëª©í‘œ ${GOAL.c2}ì¼ ì´ë‚´</div></div><div style="text-align:right"><div class="kci-value ${colorC2(me.c2)}">${me.c2||'-'}ì¼</div></div></div>
    <div class="kpi-compare-item highlight-mine"><div><div class="kci-name">ë°©ë¬¸ìœ¨</div><div class="kci-sub">ì „í™” í›„ ë°©ë¬¸ ì „í™˜ Â· ëª©í‘œ ${GOAL.visit}%</div></div><div style="text-align:right"><div class="kci-value ${colorV(me.visit)}">${me.visit}%</div></div></div>
    <div class="kpi-compare-item highlight-mine"><div><div class="kci-name">ì„±ê³µë¥ </div><div class="kci-sub">ê³„ì•½ ì „í™˜ìœ¨ Â· ëª©í‘œ ${GOAL.success}%</div></div><div style="text-align:right"><div class="kci-value ${colorS(me.success)}">${me.success}%</div></div></div>
  `;

  const bestList = document.querySelectorAll('.compare-side')[1].querySelector('.kpi-compare-list');
  bestList.innerHTML = `
    <div class="kpi-compare-item highlight-best"><div><div class="kci-name">1ì°¨ ì ‘ì´‰ê¸°ê°„</div><div class="kci-sub">ë¬¸ì˜â†’ì „í™” í‰ê·  Â· ëª©í‘œ ${GOAL.c1}ì¼ ì´ë‚´</div></div><div style="text-align:right"><div class="kci-value ${colorC1(best.c1)}">${best.c1||'-'}ì¼</div></div></div>
    <div class="kpi-compare-item highlight-best"><div><div class="kci-name">2ì°¨ ì ‘ì´‰ê¸°ê°„</div><div class="kci-sub">ì „í™”â†’ë°©ë¬¸ í‰ê·  Â· ëª©í‘œ ${GOAL.c2}ì¼ ì´ë‚´</div></div><div style="text-align:right"><div class="kci-value ${colorC2(best.c2)}">${best.c2||'-'}ì¼</div></div></div>
    <div class="kpi-compare-item highlight-best"><div><div class="kci-name">ë°©ë¬¸ìœ¨</div><div class="kci-sub">ì „í™” í›„ ë°©ë¬¸ ì „í™˜ Â· ëª©í‘œ ${GOAL.visit}%</div></div><div style="text-align:right"><div class="kci-value ${colorV(best.visit)}">${best.visit}%</div></div></div>
    <div class="kpi-compare-item highlight-best"><div><div class="kci-name">ì„±ê³µë¥ </div><div class="kci-sub">ê³„ì•½ ì „í™˜ìœ¨ Â· ëª©í‘œ ${GOAL.success}%</div></div><div style="text-align:right"><div class="kci-value ${colorS(best.success)}">${best.success}%</div></div></div>
  `;

  const actions = [];
  if (me.c1 > GOAL.c1)       actions.push(`1ì°¨ ì ‘ì´‰ ${me.c1}ì¼ â†’ ëª©í‘œ ${GOAL.c1}ì¼ ì´ë‚´: ì‹ ê·œ ë¬¸ì˜ ë‹¹ì¼ ì „í™” ì‘ëŒ€ í•„ìˆ˜ (${best.name} ${best.c1}ì¼ ë‹¬ì„± ì¤‘)`);
  if (me.c2 > GOAL.c2)       actions.push(`2ì°¨ ì ‘ì´‰ ${me.c2}ì¼ â†’ ëª©í‘œ ${GOAL.c2}ì¼ ì´ë‚´: ì „í™” í›„ ë°©ë¬¸ ì§€ì—° ê³ ê° ì¦‰ì‹œ ë°©ë¬¸ ì‹¤í–‰`);
  if (me.visit < GOAL.visit)  actions.push(`ë°©ë¬¸ìœ¨ ${me.visit}% â†’ ëª©í‘œ ${GOAL.visit}%: ë¯¸ë°©ë¬¸ ê³ ê° ì˜¤ëŠ˜ ì¤‘ ë°©ë¬¸ ì¼ì • í™•ì •`);
  if (me.success < GOAL.success) actions.push(`ì„±ê³µë¥  ${me.success}% â†’ ëª©í‘œ ${GOAL.success}%: ë°©ë¬¸ìœ¨Â·ì ‘ì´‰ì†ë„ ê°œì„  ì‹œ ìì—°íˆ ìƒìŠ¹`);
  if (actions.length === 0)   actions.push('âœ… ëª¨ë“  ì§€í‘œ ëª©í‘œ ë‹¬ì„± ì¤‘ì…ë‹ˆë‹¤! í˜„ì¬ ìˆ˜ì¤€ì„ ìœ ì§€í•˜ì„¸ìš”.');

  const guide = document.querySelector('.action-guide');
  guide.querySelector('.action-items').innerHTML = actions.map(a=>`<div class="action-item">${a}</div>`).join('');

  document.querySelectorAll('.kpi-card-sub')[0].textContent = `ë¬¸ì˜â†’ì „í™” Â· ëª©í‘œ ${GOAL.c1}ì¼ ì´ë‚´`;
  document.querySelectorAll('.kpi-card-sub')[1].textContent = `ì „í™”â†’ë°©ë¬¸ Â· ëª©í‘œ ${GOAL.c2}ì¼ ì´ë‚´`;
  document.querySelectorAll('.kpi-card-sub')[2].textContent = `ì „êµ­ í‰ê·  Â· ëª©í‘œ ${GOAL.visit}%`;
  document.querySelectorAll('.kpi-card-sub')[3].textContent = `ê³„ì•½ ì „í™˜ Â· ëª©í‘œ ${GOAL.success}%`;
}
</script>
</body>
</html>
